<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üç± - ‡∏Å‡∏¥‡∏ô ‡∏≠‡∏∞‡πÑ‡∏£ ‡∏î‡∏µ -</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&family=Mitr:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="manifest" id="pwa-manifest">
<script>
(function(){
  const manifest = {
    name: '- ‡∏Å‡∏¥‡∏ô ‡∏≠‡∏∞‡πÑ‡∏£ ‡∏î‡∏µ -',
    short_name: 'üç± ‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
    display: 'standalone',
    background_color: '#1a1008',
    theme_color: '#f5a623',
    icons: [{src:'https://cdn.jsdelivr.net/gh/twitter/twemoji@14/assets/72x72/1f371.png',sizes:'72x72',type:'image/png'}]
  };
  const blob = new Blob([JSON.stringify(manifest)], {type:'application/json'});
  document.getElementById('pwa-manifest').href = URL.createObjectURL(blob);
})();
</script>
<meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="üç± ‡∏≠‡∏≤‡∏´‡∏≤‡∏£">
<style>
:root{
  --bg:#1a1008;--bg2:#231508;--card:#2d1c0e;--card2:#3a2310;
  --accent:#f5a623;--accent2:#e8832a;--accent3:#ff6b35;
  --text:#f5e6d3;--text2:#c4a882;--text3:#8a7060;
  --green:#4caf7d;--red:#e05c5c;--blue:#7caeff;
  --border:rgba(245,166,35,0.2);--shadow:0 8px 32px rgba(0,0,0,0.5);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Kanit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;
  background-image:radial-gradient(ellipse at 20% 50%,rgba(245,166,35,0.06) 0%,transparent 60%),
  radial-gradient(ellipse at 80% 20%,rgba(232,131,42,0.04) 0%,transparent 50%);}
.page{display:none;min-height:100vh;}
.page.active{display:flex;flex-direction:column;}

/* REGISTER */
#page-register{align-items:center;justify-content:center;padding:24px;}
.register-box{background:var(--card);border:1px solid var(--border);border-radius:24px;padding:48px 40px;max-width:420px;width:100%;box-shadow:var(--shadow);text-align:center;animation:fadeUp .5s ease both;}
.logo-icon{font-size:64px;display:block;margin-bottom:16px;animation:bounce 2s ease-in-out infinite;}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.register-box h1{font-family:'Mitr',sans-serif;font-size:28px;font-weight:600;color:var(--accent);margin-bottom:6px;}
.register-box p{color:var(--text2);font-size:15px;font-weight:300;margin-bottom:36px;}
.input-group{margin-bottom:20px;}
.input-group label{display:block;text-align:left;font-size:13px;font-weight:500;color:var(--text2);margin-bottom:8px;}
.input-group input{width:100%;background:var(--bg2);border:1.5px solid var(--border);border-radius:12px;padding:14px 18px;font-family:'Kanit',sans-serif;font-size:16px;color:var(--text);outline:none;transition:border-color .2s,box-shadow .2s;}
.input-group input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(245,166,35,0.15);}
.input-group input::placeholder{color:var(--text3);}
.btn-primary{width:100%;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:12px;padding:15px;font-family:'Kanit',sans-serif;font-size:17px;font-weight:600;color:var(--bg);cursor:pointer;box-shadow:0 4px 20px rgba(245,166,35,0.3);transition:transform .15s;}
.btn-primary:hover{transform:translateY(-2px);}
@keyframes fadeUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}

/* TOPBAR */
.topbar{background:var(--card);border-bottom:1px solid var(--border);padding:12px 14px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;backdrop-filter:blur(10px);gap:8px;}
.user-chip{background:linear-gradient(135deg,rgba(245,166,35,0.2),rgba(232,131,42,0.1));border:1px solid var(--border);border-radius:20px;padding:6px 14px;font-size:13px;font-weight:500;color:var(--accent);white-space:nowrap;cursor:pointer;}
.topbar-btns{display:flex;gap:6px;flex-shrink:0;}
.cart-btn{background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:11px;padding:8px 13px;font-family:'Kanit',sans-serif;font-size:12px;font-weight:600;color:var(--bg);cursor:pointer;display:flex;align-items:center;gap:5px;transition:transform .15s;white-space:nowrap;}
.cart-btn:hover{transform:scale(1.04);}
.cart-btn.secondary{background:var(--card2);color:var(--text2);border:1px solid var(--border);}
.cart-btn.admin-btn{background:rgba(224,92,92,0.75);color:white;}
.cart-badge{background:var(--red);color:white;border-radius:10px;font-size:10px;font-weight:700;padding:1px 5px;min-width:18px;text-align:center;}

/* TABS */
.tabs-wrap{padding:12px 14px 0;border-bottom:1px solid var(--border);background:var(--bg2);}
.tabs{display:flex;gap:4px;overflow-x:auto;}
.tab-btn{background:transparent;border:none;padding:9px 16px 11px;font-family:'Kanit',sans-serif;font-size:14px;font-weight:500;color:var(--text3);cursor:pointer;border-bottom:2.5px solid transparent;transition:all .2s;border-radius:8px 8px 0 0;white-space:nowrap;flex-shrink:0;}
.tab-btn.active{color:var(--accent);border-bottom-color:var(--accent);background:rgba(245,166,35,0.06);}

/* MENU */
.tab-content{display:none;padding:14px;padding-bottom:80px;}
.tab-content.active{display:block;}
.section-title{font-family:'Mitr',sans-serif;font-size:11px;font-weight:500;color:var(--accent);letter-spacing:2px;text-transform:uppercase;margin:18px 0 9px;display:flex;align-items:center;gap:8px;}
.section-title::after{content:'';flex:1;height:1px;background:var(--border);}
.section-title:first-child{margin-top:0;}
.menu-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(270px,1fr));gap:9px;}
.menu-card{background:var(--card);border:1px solid var(--border);border-radius:13px;padding:13px;display:flex;align-items:center;gap:11px;transition:border-color .2s,transform .15s;}
.menu-card:hover{border-color:rgba(245,166,35,0.4);transform:translateY(-1px);}
.menu-card.in-cart{border-color:rgba(76,175,125,0.45);background:rgba(76,175,125,0.04);}
.menu-emoji{font-size:32px;flex-shrink:0;width:46px;height:46px;display:flex;align-items:center;justify-content:center;background:var(--card2);border-radius:10px;}
.menu-info{flex:1;min-width:0;}
.menu-name{font-size:13px;font-weight:600;color:var(--text);margin-bottom:2px;}
.menu-desc{font-size:11px;color:var(--text3);font-weight:300;}
.menu-price{font-family:'Mitr',sans-serif;font-size:14px;font-weight:600;color:var(--accent);margin-top:3px;}
.qty-ctrl{display:flex;align-items:center;gap:7px;flex-shrink:0;}
.qty-btn{width:27px;height:27px;border-radius:50%;border:1.5px solid var(--border);background:var(--card2);color:var(--text);font-size:17px;line-height:1;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .15s;}
.qty-btn:hover{background:rgba(245,166,35,0.2);border-color:var(--accent);}
.qty-btn.add{border-color:var(--accent);background:var(--accent);color:var(--bg);font-weight:700;}
.qty-num{font-size:14px;font-weight:600;min-width:16px;text-align:center;}
.note-row{margin-top:6px;display:none;}
.note-row.visible{display:block;}
.note-input{width:100%;background:var(--bg2);border:1px solid var(--border);border-radius:7px;padding:5px 10px;font-family:'Kanit',sans-serif;font-size:11px;color:var(--text2);outline:none;}
.note-input:focus{border-color:var(--accent);}
.note-input::placeholder{color:var(--text3);}
.tag{display:inline-block;font-size:10px;padding:2px 6px;border-radius:5px;font-weight:500;margin-left:4px;}
.tag-hot{background:rgba(255,107,53,0.2);color:var(--accent3);}
.tag-rec{background:rgba(76,175,125,0.2);color:var(--green);}
.tag-new{background:rgba(100,150,255,0.2);color:var(--blue);}
.empty-menu-hint{text-align:center;padding:30px;color:var(--text3);font-size:13px;}

/* BOTTOM BAR */
.bottom-bar{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--border);padding:11px 14px;display:flex;align-items:center;justify-content:space-between;z-index:50;backdrop-filter:blur(10px);gap:10px;}
.bottom-bar-info{font-size:12px;color:var(--text2);}
.bottom-bar-info span{color:var(--text);font-weight:600;font-size:14px;}
.confirm-btn{background:linear-gradient(135deg,var(--green),#38a169);border:none;border-radius:11px;padding:10px 18px;font-family:'Kanit',sans-serif;font-size:14px;font-weight:700;color:white;cursor:pointer;display:flex;align-items:center;gap:6px;flex-shrink:0;box-shadow:0 4px 16px rgba(76,175,125,0.35);transition:transform .15s;}
.confirm-btn:hover{transform:translateY(-2px);}
.confirm-btn:disabled{opacity:0.35;transform:none;cursor:not-allowed;}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.78);display:flex;align-items:center;justify-content:center;z-index:300;padding:20px;opacity:0;pointer-events:none;transition:opacity .25s;}
.modal-overlay.show{opacity:1;pointer-events:all;}
.modal-box{background:var(--card);border:1px solid rgba(245,166,35,0.3);border-radius:20px;width:100%;max-width:450px;max-height:85vh;overflow-y:auto;box-shadow:0 24px 60px rgba(0,0,0,0.7);transform:scale(.95);transition:transform .25s;}
.modal-overlay.show .modal-box{transform:scale(1);}
.modal-header{padding:16px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--card);border-radius:20px 20px 0 0;}
.modal-header h3{font-family:'Mitr',sans-serif;font-size:17px;font-weight:600;color:var(--text);}
.modal-close{background:var(--card2);border:none;border-radius:7px;padding:5px 9px;color:var(--text3);cursor:pointer;font-size:14px;}
.modal-body{padding:14px 18px;}
.modal-item-row{display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid rgba(245,166,35,0.07);}
.modal-item-row:last-child{border-bottom:none;}
.mi-emoji{font-size:22px;width:32px;text-align:center;flex-shrink:0;}
.mi-info{flex:1;}
.mi-name{font-size:13px;font-weight:500;}
.mi-sub{font-size:11px;color:var(--text3);margin-top:1px;}
.mi-right{text-align:right;flex-shrink:0;}
.mi-qty{font-size:11px;color:var(--text3);}
.mi-price{font-family:'Mitr',sans-serif;font-size:14px;font-weight:600;color:var(--text2);}
.modal-total{background:rgba(245,166,35,0.08);border:1px solid rgba(245,166,35,0.2);border-radius:11px;padding:12px 14px;margin:12px 0;display:flex;justify-content:space-between;align-items:center;}
.modal-total span{font-size:13px;color:var(--text2);}
.modal-total strong{font-family:'Mitr',sans-serif;font-size:22px;font-weight:700;color:var(--accent);}
.modal-footer{padding:0 18px 18px;display:flex;gap:9px;}
.modal-cancel{flex:1;background:var(--card2);border:1px solid var(--border);border-radius:11px;padding:12px;font-family:'Kanit',sans-serif;font-size:13px;font-weight:600;color:var(--text2);cursor:pointer;}
.modal-submit{flex:2;background:linear-gradient(135deg,var(--green),#38a169);border:none;border-radius:11px;padding:12px;font-family:'Kanit',sans-serif;font-size:14px;font-weight:700;color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7px;transition:transform .15s;}
.modal-submit:hover{transform:scale(1.02);}
.modal-submit:disabled{opacity:0.5;cursor:not-allowed;transform:none;}

/* BROADCAST NOTIFICATION MODAL */
.bcast-modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.82);z-index:9500;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn .25s ease;}
.bcast-modal-box{background:var(--card);border:2px solid var(--accent);border-radius:20px;padding:22px 20px;max-width:360px;width:100%;}
.bcast-modal-title{font-family:'Mitr',sans-serif;font-size:17px;font-weight:700;color:var(--accent);margin-bottom:14px;text-align:center;}
.bcast-option{display:block;width:100%;background:var(--card2);border:1.5px solid var(--border);border-radius:12px;padding:12px 16px;margin-bottom:10px;font-family:'Kanit',sans-serif;font-size:14px;color:var(--text);cursor:pointer;text-align:left;transition:border-color .15s,background .15s;}
.bcast-option:hover,.bcast-option.selected{border-color:var(--accent);background:rgba(245,166,35,0.1);color:var(--accent);}
.bcast-textarea{width:100%;background:var(--bg2);border:1.5px solid var(--border);border-radius:12px;padding:10px 14px;font-family:'Kanit',sans-serif;font-size:14px;color:var(--text);resize:none;margin-bottom:12px;box-sizing:border-box;}
.bcast-textarea:focus{outline:none;border-color:var(--accent);}
.bcast-send-btn{width:100%;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:12px;padding:13px;font-family:'Kanit',sans-serif;font-size:15px;font-weight:700;color:var(--bg);cursor:pointer;}
.bcast-cancel-btn{width:100%;background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:11px;font-family:'Kanit',sans-serif;font-size:14px;color:var(--text2);cursor:pointer;margin-top:8px;}


/* QR NOTIFICATION POPUP */
.qr-notif-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.92);z-index:10000;display:flex;align-items:center;justify-content:center;padding:16px;overflow-y:auto;animation:fadeIn .3s ease;}
.qr-notif-box{background:var(--card);border:2px solid var(--accent);border-radius:24px;padding:20px 18px;max-width:340px;width:100%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.8);animation:popUp .35s cubic-bezier(.34,1.56,.64,1);margin-top:auto;margin-bottom:auto;}
@keyframes popUp{from{transform:scale(0.7);opacity:0}to{transform:scale(1);opacity:1}}
.qr-notif-title{font-family:'Mitr',sans-serif;font-size:13px;color:var(--text2);margin-bottom:4px;}
.qr-notif-name{font-family:'Mitr',sans-serif;font-size:20px;font-weight:700;color:var(--accent);margin-bottom:2px;}
.qr-notif-amount{font-family:'Mitr',sans-serif;font-size:36px;font-weight:700;color:var(--text);margin:4px 0;}
.qr-notif-img{width:170px;height:170px;border-radius:12px;margin:6px auto;display:block;background:#fff;padding:4px;}
.qr-notif-items{background:var(--bg2);border-radius:10px;padding:8px 12px;margin:8px 0;text-align:left;font-size:12px;color:var(--text2);max-height:80px;overflow-y:auto;}
.qr-notif-items div{padding:3px 0;border-bottom:1px solid rgba(255,255,255,0.05);}
.qr-notif-items div:last-child{border:none;}
.qr-notif-close{width:100%;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:12px;padding:13px;font-family:'Kanit',sans-serif;font-size:15px;font-weight:700;color:var(--bg);cursor:pointer;margin-top:6px;}

/* SPIN WHEEL */
.spin-float-btn{position:fixed;bottom:80px;right:16px;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:50%;width:54px;height:54px;font-size:24px;cursor:pointer;box-shadow:0 4px 20px rgba(245,166,35,0.5);z-index:200;display:flex;align-items:center;justify-content:center;transition:transform .2s;}
.spin-float-btn:hover{transform:scale(1.1) rotate(-10deg);}
.spin-modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.88);z-index:9000;display:flex;align-items:center;justify-content:center;padding:16px;animation:fadeIn .25s ease;}
.spin-modal-box{background:var(--card);border:2px solid var(--accent);border-radius:24px;padding:20px 18px;max-width:340px;width:100%;text-align:center;position:relative;animation:popUp .35s cubic-bezier(.34,1.56,.64,1);}
.spin-modal-close{position:absolute;top:12px;right:12px;background:var(--card2);border:none;border-radius:8px;padding:5px 9px;color:var(--text3);cursor:pointer;font-size:14px;}
.spin-wrap{display:flex;flex-direction:column;align-items:center;padding:20px 14px 40px;}
.spin-title{font-family:'Mitr',sans-serif;font-size:18px;font-weight:700;color:var(--accent);margin-bottom:16px;text-align:center;}
.wheel-outer{position:relative;width:260px;height:260px;border-radius:50%;box-shadow:0 0 0 6px var(--accent),0 0 0 10px rgba(245,166,35,0.25),0 8px 32px rgba(0,0,0,0.5);margin-bottom:8px;flex-shrink:0;}
canvas#spin-canvas{border-radius:50%;display:block;width:260px;height:260px;}
.wheel-pointer{position:absolute;top:-18px;left:50%;transform:translateX(-50%);font-size:32px;line-height:1;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.5));z-index:10;}
.spin-btn{margin-top:18px;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:50px;padding:14px 48px;font-family:'Mitr',sans-serif;font-size:17px;font-weight:700;color:var(--bg);cursor:pointer;box-shadow:0 4px 20px rgba(245,166,35,0.4);transition:transform .15s,box-shadow .15s;}
.spin-btn:hover{transform:scale(1.04);}
.spin-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none;}
.spin-result{margin-top:16px;background:var(--card);border:2px solid var(--accent);border-radius:16px;padding:14px 20px;text-align:center;min-width:220px;animation:popUp .3s cubic-bezier(.34,1.56,.64,1);}
.spin-result-emoji{font-size:36px;margin-bottom:4px;}
.spin-result-name{font-family:'Mitr',sans-serif;font-size:18px;font-weight:700;color:var(--text);}
.spin-result-rest{font-size:12px;color:var(--text3);margin-top:2px;}
.spin-result-price{font-family:'Mitr',sans-serif;font-size:22px;font-weight:700;color:var(--accent);margin-top:4px;}
.spin-add-btn{margin-top:10px;background:var(--green);border:none;border-radius:10px;padding:10px 24px;font-family:'Kanit',sans-serif;font-size:14px;font-weight:700;color:white;cursor:pointer;}

/* PAGE HEADER */
.page-header{background:var(--card);border-bottom:1px solid var(--border);padding:14px;display:flex;align-items:center;gap:10px;position:sticky;top:0;z-index:50;}
.back-btn{background:var(--card2);border:1px solid var(--border);border-radius:9px;padding:7px 12px;font-family:'Kanit',sans-serif;font-size:12px;color:var(--text2);cursor:pointer;flex-shrink:0;}
.back-btn:hover{color:var(--accent);}
.page-header h2{font-family:'Mitr',sans-serif;font-size:17px;font-weight:600;color:var(--text);flex:1;}
.refresh-btn{background:var(--card2);border:1px solid var(--border);border-radius:9px;padding:7px 11px;font-size:15px;cursor:pointer;transition:transform .4s;flex-shrink:0;}
.refresh-btn:hover{transform:rotate(180deg);}
.page-body{padding:14px;padding-bottom:40px;}

/* ORDER TABLE */
.order-table-wrap{border-radius:13px;overflow:hidden;border:1px solid var(--border);margin-bottom:14px;}
.order-table{width:100%;border-collapse:collapse;font-size:12px;}
.order-table thead tr{background:linear-gradient(135deg,rgba(245,166,35,0.18),rgba(232,131,42,0.1));border-bottom:1px solid rgba(245,166,35,0.3);}
.order-table thead th{padding:10px 11px;text-align:left;font-size:10px;font-weight:600;color:var(--accent);letter-spacing:.8px;text-transform:uppercase;white-space:nowrap;}
.order-table thead th.center{text-align:center;}
.order-table tbody tr{border-bottom:1px solid rgba(245,166,35,0.07);transition:background .15s;}
.order-table tbody tr:last-child{border-bottom:none;}
.order-table tbody tr:hover{background:rgba(245,166,35,0.04);}
.order-table td{padding:10px 11px;color:var(--text);vertical-align:middle;}
.order-table td.center{text-align:center;}
.td-food{display:flex;align-items:center;gap:8px;}
.td-food-emoji{font-size:18px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:var(--card2);border-radius:7px;flex-shrink:0;}
.td-food-name{font-weight:500;font-size:12px;}
.td-food-note{font-size:10px;color:var(--text3);margin-top:1px;}
.td-qty{background:rgba(245,166,35,0.12);color:var(--accent);font-weight:700;font-size:12px;border-radius:14px;padding:2px 9px;display:inline-block;font-family:'Mitr',sans-serif;}
.td-price{font-family:'Mitr',sans-serif;font-size:13px;font-weight:600;color:var(--text2);}
.td-person{display:inline-flex;align-items:center;gap:4px;background:rgba(76,175,125,0.12);color:var(--green);border-radius:14px;padding:2px 9px;font-size:11px;font-weight:500;white-space:nowrap;}
.td-restaurant{display:inline-flex;align-items:center;background:rgba(124,174,255,0.1);color:var(--blue);border-radius:14px;padding:2px 9px;font-size:10px;font-weight:500;white-space:nowrap;}
.td-time{font-size:10px;color:var(--text3);white-space:nowrap;}
.table-footer{background:linear-gradient(135deg,var(--card2),var(--card));border-top:1.5px solid rgba(245,166,35,0.3);padding:12px 14px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;}
.stat-pill{font-size:12px;color:var(--text2);}
.stat-pill strong{color:var(--text);font-weight:600;}
.table-footer-total{font-family:'Mitr',sans-serif;font-size:19px;font-weight:700;color:var(--accent);}
.person-sums-wrap{display:flex;flex-direction:column;gap:8px;margin-bottom:14px;}
.person-sum-pill{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:11px 16px;display:flex;align-items:center;justify-content:space-between;}
.person-sum-price{font-family:'Mitr',sans-serif;font-size:17px;font-weight:700;color:var(--accent);}
.clear-btn{background:rgba(224,92,92,0.12);border:1px solid rgba(224,92,92,0.3);border-radius:10px;padding:10px 16px;font-family:'Kanit',sans-serif;font-size:13px;font-weight:500;color:var(--red);cursor:pointer;margin-top:14px;width:100%;transition:background .15s;}
.clear-btn:hover{background:rgba(224,92,92,0.22);}

/* ADMIN TABS */
.admin-tabs-wrap{background:var(--bg2);border-bottom:1px solid var(--border);padding:0 14px;}
.admin-tabs{display:flex;gap:4px;}
.admin-tab-btn{background:transparent;border:none;padding:11px 18px 13px;font-family:'Kanit',sans-serif;font-size:13px;font-weight:500;color:var(--text3);cursor:pointer;border-bottom:2.5px solid transparent;transition:all .2s;white-space:nowrap;}
.admin-tab-btn.active{color:var(--red);border-bottom-color:var(--red);}
.admin-tab-content{display:none;}
.admin-tab-content.active{display:block;}

/* ADMIN PRICE */
.admin-phone-bar{background:var(--card2);border-bottom:1px solid var(--border);padding:12px 14px;display:flex;align-items:center;gap:10px;}
.admin-phone-bar label{font-size:12px;color:var(--text2);flex-shrink:0;}
.admin-phone-input{flex:1;background:var(--bg2);border:1.5px solid var(--border);border-radius:10px;padding:9px 12px;font-family:'Kanit',sans-serif;font-size:14px;color:var(--text);outline:none;transition:border-color .2s;}
.admin-phone-input:focus{border-color:var(--accent);}
.admin-phone-input::placeholder{color:var(--text3);}
.admin-table-wrap{border-radius:13px;overflow:hidden;border:1px solid rgba(224,92,92,0.3);margin-bottom:16px;}
.admin-table{width:100%;border-collapse:collapse;font-size:12px;}
.admin-table thead tr{background:linear-gradient(135deg,rgba(224,92,92,0.2),rgba(224,92,92,0.1));border-bottom:1px solid rgba(224,92,92,0.3);}
.admin-table thead th{padding:10px 11px;text-align:left;font-size:10px;font-weight:600;color:#ffaaaa;letter-spacing:.8px;text-transform:uppercase;white-space:nowrap;}
.admin-table thead th.center{text-align:center;}
.admin-table tbody tr{border-bottom:1px solid rgba(245,166,35,0.07);}
.admin-table tbody tr:last-child{border-bottom:none;}
.admin-table td{padding:9px 11px;vertical-align:middle;}
.admin-table td.center{text-align:center;}
.admin-price-orig{font-size:11px;color:var(--text3);text-decoration:line-through;margin-bottom:2px;}
.admin-price-input{width:76px;background:var(--bg2);border:1.5px solid rgba(245,166,35,0.3);border-radius:8px;padding:5px 8px;font-family:'Mitr',sans-serif;font-size:13px;color:var(--accent);text-align:center;outline:none;}
.admin-price-input.changed{border-color:var(--red);color:var(--red);background:rgba(224,92,92,0.06);}
.admin-confirm-bar{background:var(--card);border-top:1px solid var(--border);padding:12px 14px;display:flex;align-items:center;justify-content:space-between;gap:10px;}
.admin-confirm-btn{background:linear-gradient(135deg,#e05c5c,#c0392b);border:none;border-radius:11px;padding:11px 20px;font-family:'Kanit',sans-serif;font-size:14px;font-weight:700;color:white;cursor:pointer;display:flex;align-items:center;gap:7px;box-shadow:0 4px 16px rgba(224,92,92,0.3);transition:transform .15s;}
.admin-confirm-btn:hover{transform:translateY(-2px);}
.admin-total-preview{font-size:13px;color:var(--text2);}
.admin-total-preview strong{font-family:'Mitr',sans-serif;font-size:18px;color:var(--red);}

/* QR */
.qr-section{padding:14px;}
.qr-section h3{font-family:'Mitr',sans-serif;font-size:16px;font-weight:600;color:var(--text);margin-bottom:14px;}
.qr-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;}
.qr-card{background:var(--card);border:1.5px solid var(--border);border-radius:16px;overflow:hidden;text-align:center;transition:border-color .4s,background .4s;}
.qr-card.paid{border-color:#4caf7d;background:rgba(76,175,125,0.07);}
.qr-card-header{background:linear-gradient(135deg,rgba(245,166,35,0.15),rgba(232,131,42,0.08));border-bottom:1px solid var(--border);padding:10px 14px;transition:background .4s;}
.qr-card.paid .qr-card-header{background:linear-gradient(135deg,rgba(76,175,125,0.25),rgba(56,161,105,0.12));border-bottom-color:rgba(76,175,125,0.3);}
.qr-card-name{font-size:14px;font-weight:600;color:var(--accent);}
.qr-card-amount{font-family:'Mitr',sans-serif;font-size:24px;font-weight:700;color:var(--text);margin-top:2px;}
.qr-paid-badge{display:inline-block;background:var(--green);color:#fff;border-radius:20px;padding:2px 10px;font-size:11px;font-weight:700;margin-top:4px;animation:fadeIn .4s ease;}
.qr-img-wrap{padding:14px;background:white;margin:12px;border-radius:12px;display:flex;align-items:center;justify-content:center;}
.qr-img-wrap img{display:block;width:180px;height:180px;}
.qr-items-list{padding:0 14px 10px;text-align:left;}
.qr-item-row{display:flex;justify-content:space-between;font-size:11px;color:var(--text2);padding:3px 0;border-bottom:1px solid rgba(245,166,35,0.06);}
.qr-item-row:last-child{border-bottom:none;}
.qr-item-name{color:var(--text);}
.qr-save-btn{margin:0 14px 14px;width:calc(100% - 28px);background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:10px;padding:10px;font-family:'Kanit',sans-serif;font-size:13px;font-weight:600;color:var(--bg);cursor:pointer;transition:transform .15s;display:flex;align-items:center;justify-content:center;gap:6px;text-decoration:none;}
.qr-save-btn:hover{transform:scale(1.02);}

/* ‚ïê‚ïê‚ïê ADMIN MENU EDITOR ‚ïê‚ïê‚ïê */
.menu-editor-wrap{padding:14px;padding-bottom:90px;}
.me-toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;gap:10px;flex-wrap:wrap;}
.me-toolbar h3{font-family:'Mitr',sans-serif;font-size:16px;font-weight:600;color:var(--text);}
.me-add-rest-btn{background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:10px;padding:9px 16px;font-family:'Kanit',sans-serif;font-size:13px;font-weight:600;color:var(--bg);cursor:pointer;display:flex;align-items:center;gap:6px;transition:transform .15s;flex-shrink:0;}
.me-add-rest-btn:hover{transform:scale(1.03);}
.me-restaurant-card{background:var(--card);border:1px solid var(--border);border-radius:14px;margin-bottom:12px;overflow:hidden;}
.me-rest-header{padding:12px 14px;display:flex;align-items:center;gap:10px;background:linear-gradient(135deg,rgba(245,166,35,0.12),rgba(232,131,42,0.06));cursor:pointer;user-select:none;}
.me-rest-emoji-btn{font-size:22px;background:var(--card2);border:1px solid var(--border);border-radius:8px;padding:4px 8px;cursor:pointer;transition:background .15s;}
.me-rest-name-input{flex:1;background:transparent;border:none;font-family:'Kanit',sans-serif;font-size:15px;font-weight:600;color:var(--accent);outline:none;min-width:0;}
.me-rest-name-input:focus{background:rgba(245,166,35,0.06);border-radius:6px;padding:2px 6px;}
.me-rest-actions{display:flex;gap:6px;flex-shrink:0;}
.me-icon-btn{background:var(--card2);border:1px solid var(--border);border-radius:8px;padding:5px 9px;font-size:13px;cursor:pointer;transition:background .15s;color:var(--text2);}
.me-icon-btn:hover{background:rgba(245,166,35,0.15);color:var(--accent);}
.me-icon-btn.danger:hover{background:rgba(224,92,92,0.15);color:var(--red);border-color:rgba(224,92,92,0.3);}
.me-rest-body{padding:12px 14px 14px;}
.me-category-block{margin-bottom:12px;}
.me-cat-header{display:flex;align-items:center;gap:8px;margin-bottom:8px;}
.me-cat-name-input{flex:1;background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:6px 10px;font-family:'Kanit',sans-serif;font-size:12px;color:var(--text2);outline:none;transition:border-color .2s;}
.me-cat-name-input:focus{border-color:var(--accent);color:var(--text);}
.me-items-list{display:flex;flex-direction:column;gap:7px;margin-bottom:8px;}
.me-item-row{background:var(--bg2);border:1px solid rgba(245,166,35,0.1);border-radius:10px;padding:9px 11px;display:flex;align-items:center;gap:8px;}
.me-item-emoji-btn{font-size:20px;background:var(--card);border:1px solid var(--border);border-radius:7px;padding:3px 7px;cursor:pointer;flex-shrink:0;}
.me-item-fields{flex:1;display:grid;grid-template-columns:1fr auto auto;gap:6px;min-width:0;}
.me-item-name{background:transparent;border:none;border-bottom:1px solid var(--border);font-family:'Kanit',sans-serif;font-size:13px;font-weight:500;color:var(--text);outline:none;padding:2px 4px;width:100%;}
.me-item-name:focus{border-bottom-color:var(--accent);}
.me-item-desc{background:transparent;border:none;border-bottom:1px solid transparent;font-family:'Kanit',sans-serif;font-size:11px;color:var(--text3);outline:none;padding:2px 4px;width:100%;grid-column:1/-1;}
.me-item-desc:focus{border-bottom-color:var(--border);}
.me-item-price{background:var(--card);border:1px solid rgba(245,166,35,0.3);border-radius:7px;padding:4px 8px;font-family:'Mitr',sans-serif;font-size:13px;font-weight:600;color:var(--accent);text-align:center;outline:none;width:70px;flex-shrink:0;}
.me-item-tag{background:var(--card);border:1px solid var(--border);border-radius:7px;padding:4px 7px;font-family:'Kanit',sans-serif;font-size:11px;color:var(--text3);outline:none;cursor:pointer;flex-shrink:0;}
.me-add-item-btn{background:rgba(76,175,125,0.12);border:1px dashed rgba(76,175,125,0.4);border-radius:9px;padding:7px 12px;font-family:'Kanit',sans-serif;font-size:12px;color:var(--green);cursor:pointer;width:100%;transition:background .15s;margin-top:4px;}
.me-add-item-btn:hover{background:rgba(76,175,125,0.2);}
.me-add-cat-btn{background:rgba(124,174,255,0.08);border:1px dashed rgba(124,174,255,0.3);border-radius:9px;padding:8px 14px;font-family:'Kanit',sans-serif;font-size:12px;color:var(--blue);cursor:pointer;width:100%;transition:background .15s;margin-top:6px;}
.me-add-cat-btn:hover{background:rgba(124,174,255,0.15);}
.me-save-bar{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--border);padding:12px 14px;display:flex;align-items:center;justify-content:space-between;z-index:60;backdrop-filter:blur(10px);gap:10px;}
.me-save-btn{background:linear-gradient(135deg,var(--green),#38a169);border:none;border-radius:11px;padding:12px 24px;font-family:'Kanit',sans-serif;font-size:14px;font-weight:700;color:white;cursor:pointer;display:flex;align-items:center;gap:7px;box-shadow:0 4px 16px rgba(76,175,125,0.35);transition:transform .15s;}
.me-save-btn:hover{transform:translateY(-2px);}
.me-save-info{font-size:12px;color:var(--text3);}

/* EMOJI PICKER */
.emoji-picker-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:600;padding:20px;opacity:0;pointer-events:none;transition:opacity .2s;}
.emoji-picker-overlay.show{opacity:1;pointer-events:all;}
.emoji-picker-box{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;max-width:340px;width:100%;box-shadow:var(--shadow);}
.emoji-picker-box h4{font-size:14px;font-weight:600;color:var(--text2);margin-bottom:12px;}
.emoji-input-row{display:flex;gap:8px;margin-bottom:12px;}
.emoji-text-input{flex:1;background:var(--bg2);border:1.5px solid var(--border);border-radius:9px;padding:9px 12px;font-family:'Kanit',sans-serif;font-size:15px;color:var(--text);outline:none;}
.emoji-text-input:focus{border-color:var(--accent);}
.emoji-confirm-btn{background:var(--accent);border:none;border-radius:9px;padding:9px 14px;font-family:'Kanit',sans-serif;font-size:13px;font-weight:600;color:var(--bg);cursor:pointer;}
.emoji-grid{display:flex;flex-wrap:wrap;gap:6px;max-height:200px;overflow-y:auto;}
.emoji-grid button{background:var(--card2);border:1px solid var(--border);border-radius:8px;padding:6px 10px;font-size:20px;cursor:pointer;transition:background .15s;}
.emoji-grid button:hover{background:rgba(245,166,35,0.2);}

/* EDIT NAME */
.edit-name-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:500;padding:20px;opacity:0;pointer-events:none;transition:opacity .2s;}
.edit-name-overlay.show{opacity:1;pointer-events:all;}
.edit-name-box{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:24px;width:100%;max-width:360px;box-shadow:var(--shadow);}
.edit-name-box h3{font-family:'Mitr',sans-serif;font-size:16px;font-weight:600;color:var(--text);margin-bottom:16px;}
.edit-name-input{width:100%;background:var(--bg2);border:1.5px solid var(--border);border-radius:11px;padding:12px 16px;font-family:'Kanit',sans-serif;font-size:16px;color:var(--text);outline:none;transition:border-color .2s;margin-bottom:14px;}
.edit-name-input:focus{border-color:var(--accent);}
.edit-name-btns{display:flex;gap:9px;}
.edit-name-cancel{flex:1;background:var(--card2);border:1px solid var(--border);border-radius:10px;padding:11px;font-family:'Kanit',sans-serif;font-size:13px;font-weight:600;color:var(--text2);cursor:pointer;}
.edit-name-save{flex:2;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:10px;padding:11px;font-family:'Kanit',sans-serif;font-size:14px;font-weight:700;color:var(--bg);cursor:pointer;}

/* STATES */
.empty-state{text-align:center;padding:55px 20px;color:var(--text3);}
.empty-state .empty-icon{font-size:50px;margin-bottom:12px;}
.empty-state p{font-size:14px;}
.loading-state{text-align:center;padding:50px 20px;color:var(--text2);}
.spinner{display:inline-block;width:34px;height:34px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;margin-bottom:12px;}
@keyframes spin{to{transform:rotate(360deg)}}
.toast{position:fixed;bottom:88px;left:50%;transform:translateX(-50%) translateY(20px);padding:9px 18px;border-radius:18px;font-size:13px;font-weight:500;opacity:0;pointer-events:none;transition:all .3s ease;z-index:700;white-space:nowrap;}
.toast.success{background:var(--green);color:white;}
.toast.error{background:var(--red);color:white;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
@media(max-width:480px){.register-box{padding:36px 22px;}.menu-grid{grid-template-columns:1fr;}.me-item-fields{grid-template-columns:1fr auto;}}

  /* VARIANTS */
  .variant-table{width:100%;border-collapse:collapse;margin-top:6px;grid-column:1/-1;}
  .variant-row{display:flex;align-items:center;gap:6px;margin-bottom:4px;}
  .variant-label-input{flex:1;background:transparent;border:none;border-bottom:1px solid var(--border);font-family:'Kanit',sans-serif;font-size:12px;color:var(--text2);outline:none;padding:2px 4px;min-width:60px;}
  .variant-label-input:focus{border-bottom-color:var(--accent);}
  .variant-price-input{width:64px;background:var(--card);border:1px solid rgba(245,166,35,0.3);border-radius:7px;padding:4px 7px;font-family:'Mitr',sans-serif;font-size:13px;font-weight:600;color:var(--accent);text-align:center;outline:none;flex-shrink:0;}
  .variant-del-btn{background:none;border:none;color:var(--text3);cursor:pointer;font-size:14px;flex-shrink:0;padding:0 2px;}
  .variant-del-btn:hover{color:var(--red);}
  .add-variant-btn{background:rgba(245,166,35,0.07);border:1px dashed rgba(245,166,35,0.3);border-radius:6px;padding:3px 10px;font-family:'Kanit',sans-serif;font-size:11px;color:var(--text3);cursor:pointer;margin-top:2px;grid-column:1/-1;transition:background .15s;}
  .add-variant-btn:hover{background:rgba(245,166,35,0.15);color:var(--accent);}
  /* VARIANT SELECTOR IN MENU CARD */
  .variant-btns{display:flex;flex-wrap:wrap;gap:5px;margin-top:5px;}
  .variant-btn{background:var(--card2);border:1.5px solid var(--border);border-radius:8px;padding:4px 10px;font-family:'Kanit',sans-serif;font-size:11px;color:var(--text2);cursor:pointer;transition:all .15s;display:flex;flex-direction:column;align-items:center;line-height:1.3;}
  .variant-btn:hover{border-color:var(--accent);color:var(--accent);}
  .variant-btn.selected{border-color:var(--green);background:rgba(76,175,125,0.12);color:var(--green);}
  .variant-btn .vb-label{font-size:10px;}
  .variant-btn .vb-price{font-family:'Mitr',sans-serif;font-size:13px;font-weight:600;}
</style>
</head>
<body>

<!-- PAGE 1: REGISTER -->
<div id="page-register" class="page active">
  <div class="register-box">
    <span class="logo-icon">üç±</span>
    <h1>- ‡∏Å‡∏¥‡∏ô ‡∏≠‡∏∞‡πÑ‡∏£ ‡∏î‡∏µ -</h1>
    <p>‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>
    <div class="input-group">
      <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
      <input type="text" id="name-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏°‡∏ä‡∏≤‡∏¢, ‡∏ô‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏°..." maxlength="30" autocomplete="off">
    </div>
    <button class="btn-primary" onclick="doRegister()">‚úì &nbsp;‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÄ‡∏°‡∏ô‡∏π</button>
  </div>
</div>

<!-- PAGE 2: MENU -->
<div id="page-menu" class="page">
  <button class="spin-float-btn" onclick="openSpinModal()" title="‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π">üé∞</button>
  <div class="topbar">
    <div class="user-chip" onclick="editName()" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠">üë§ <span id="display-name">‡∏ä‡∏∑‡πà‡∏≠</span> <span style="font-size:10px;opacity:.6;">‚úèÔ∏è</span></div>
    <div class="topbar-btns">
      <button class="cart-btn secondary" onclick="goToAllOrders()">
        üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <span class="cart-badge" id="cart-badge">0</span>
      </button>
      <button class="cart-btn admin-btn" onclick="goToAdmin()">üîß Admin</button>
    </div>
  </div>
  <div class="tabs-wrap">
    <div class="tabs" id="menu-tabs"></div>
  </div>
  <div id="menu-tab-contents"></div>
  <div class="bottom-bar">
    <div>
      <div class="bottom-bar-info">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ <span id="my-item-count">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
      <div class="bottom-bar-info">‡∏¢‡∏≠‡∏î <span id="my-total">‡∏ø0</span></div>
    </div>
    <button class="confirm-btn" id="confirm-btn" onclick="openConfirmModal()" disabled>‚úì ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á</button>
  </div>
</div>

<!-- PAGE 3: ALL ORDERS -->
<div id="page-allorders" class="page">
  <div class="page-header">
    <button class="back-btn" onclick="goBack()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
    <h2>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
    <button class="refresh-btn" onclick="refreshAllOrders()">üîÑ</button>
  </div>
  <div class="page-body" id="allorders-content"></div>
</div>

<!-- PAGE 4: ADMIN -->
<div id="page-admin" class="page">
  <div class="page-header">
    <button class="back-btn" onclick="goBack()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
    <h2>üîß Admin</h2>
    <button class="refresh-btn" id="test-conn-btn" onclick="testConnection()" title="‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠">üîå</button>
    <button class="refresh-btn" onclick="openBcastModal()" title="‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô" style="background:rgba(245,166,35,0.15);border:1px solid rgba(245,166,35,0.3);">üì£</button>
    <button class="refresh-btn" onclick="testNotification()" title="‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô" style="background:rgba(100,200,100,0.15);border:1px solid rgba(100,200,100,0.3);">üîî</button>
    <button class="refresh-btn" onclick="fixSheets()" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Sheets headers">üîß</button>
    <button class="refresh-btn" onclick="refreshAdminTab()">üîÑ</button>
  </div>
  <!-- Admin sub-tabs -->
  <div class="admin-tabs-wrap">
    <div class="admin-tabs">
      <button class="admin-tab-btn active" onclick="switchAdminTab('admin-price-tab',this)">üí∞ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤</button>
      <button class="admin-tab-btn" onclick="switchAdminTab('admin-menu-tab',this)">üçΩÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π</button>
    </div>
  </div>

  <!-- TAB: ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤ -->
  <div class="admin-tab-content active" id="admin-price-tab">
    <div class="admin-phone-bar">
      <label>üì± PromptPay:</label>
      <input class="admin-phone-input" type="tel" id="admin-phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô 0812345678" maxlength="15"
        onblur="savePhoneNow()" onkeydown="if(event.key==='Enter'){this.blur();}">
    </div>
    <div class="page-body">
      <div id="admin-orders-content"></div>
      <div id="admin-qr-section" class="qr-section" style="display:none;">
        <h3>üí≥ QR PromptPay ‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô</h3>
        <div class="qr-cards" id="qr-cards-wrap"></div>
      </div>
    </div>
    <div class="admin-confirm-bar" id="admin-confirm-bar" style="display:none;">
      <div class="admin-total-preview">‡∏¢‡∏≠‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏£‡∏ß‡∏° <strong id="admin-grand-total">‡∏ø0</strong></div>
      <button class="admin-confirm-btn" onclick="confirmAdminPrices()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô & ‡∏™‡∏£‡πâ‡∏≤‡∏á QR</button>
    </div>
  </div>

  <!-- TAB: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π -->
  <div class="admin-tab-content" id="admin-menu-tab">
    <div class="menu-editor-wrap" id="menu-editor-wrap">
      <div class="loading-state"><div class="spinner"></div><br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
    </div>
    <div class="me-save-bar">
      <div class="me-save-info" id="me-save-info">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
      <button class="me-save-btn" onclick="saveMenusToSheet()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏ô‡∏π</button>

    </div>
  </div>
</div>

<!-- EMOJI PICKER -->
<div class="emoji-picker-overlay" id="emoji-picker-overlay" onclick="closeEmojiIfOutside(event)">
  <div class="emoji-picker-box">
    <h4>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Emoji</h4>
    <div class="emoji-input-row">
      <input class="emoji-text-input" type="text" id="emoji-custom-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå emoji ‡πÄ‡∏≠‡∏á..." maxlength="4">
      <button class="emoji-confirm-btn" onclick="pickEmojiCustom()">‚úì ‡πÉ‡∏ä‡πâ</button>
    </div>
    <div class="emoji-grid" id="emoji-grid"></div>
  </div>
</div>

<!-- EDIT NAME MODAL -->
<div class="edit-name-overlay" id="edit-name-overlay" onclick="closeEditNameIfOutside(event)">
  <div class="edit-name-box">
    <h3>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠</h3>
    <input class="edit-name-input" type="text" id="edit-name-input" maxlength="30" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
    <div class="edit-name-btns">
      <button class="edit-name-cancel" onclick="closeEditName()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="edit-name-save" onclick="saveName()">‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
  </div>
</div>

<!-- BROADCAST NOTIFICATION MODAL -->
<div id="bcast-modal-overlay" class="bcast-modal-overlay" style="display:none;">
  <div class="bcast-modal-box">
    <div class="bcast-modal-title">üì£ ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô</div>
    <button class="bcast-option" onclick="selectBcastOption(this)">üì¢ ‡∏™‡∏±‡πà‡∏á‡∏Ç‡πâ‡∏≤‡∏ß ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡πâ‡∏≤‡∏ô ‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á ‡∏Ñ‡∏£‡∏±‡∏ö</button>
    <button class="bcast-option" onclick="selectBcastOption(this)">üì¢ ‡∏™‡∏±‡πà‡∏á‡∏Ç‡πâ‡∏≤‡∏ß ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡πâ‡∏≤‡∏ô ‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π ‡∏Ñ‡∏£‡∏±‡∏ö</button>
    <textarea id="bcast-custom" class="bcast-textarea" rows="3" placeholder="‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏≠‡∏á..." oninput="deselectBcastOptions()"></textarea>
    <button class="bcast-send-btn" onclick="sendBroadcast()">üì£ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
    <button class="bcast-cancel-btn" onclick="closeBcastModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>
</div>

<!-- BROADCAST POPUP (same style as QR notify) -->
<div id="bcast-notif-overlay" style="display:none;">
  <div class="qr-notif-box" style="max-width:320px;">
    <div class="qr-notif-title">üì£ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</div>
    <div style="font-size:48px;margin:10px 0;">üç±</div>
    <div id="bcast-notif-text" style="font-family:'Mitr',sans-serif;font-size:20px;font-weight:700;color:var(--text);margin:8px 0;line-height:1.5;"></div>
    <button class="qr-notif-close" onclick="closeBcastNotif()" style="margin-top:14px;">‚úÖ ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
  </div>
</div>

<!-- SPIN WHEEL MODAL -->
<div id="spin-modal-overlay" class="spin-modal-overlay" style="display:none;" onclick="if(event.target.id==='spin-modal-overlay')closeSpinModal()">
  <div class="spin-modal-box">
    <button class="spin-modal-close" onclick="closeSpinModal()">‚úï</button>
    <div class="spin-title">üé∞ ‡∏Å‡∏¥‡∏ô ‡∏≠‡∏∞‡πÑ‡∏£ ‡∏î‡∏µ?</div>
    <div class="wheel-outer" style="margin:0 auto 4px;">
      <div class="wheel-pointer">‚ñº</div>
      <canvas id="spin-canvas" width="260" height="260"></canvas>
    </div>
    <button class="spin-btn" id="spin-btn" onclick="spinWheel()">üé≤ ‡∏´‡∏°‡∏∏‡∏ô!</button>
    <div id="spin-result" style="display:none;margin-top:12px;"></div>
  </div>
</div>

<!-- CONFIRM ORDER MODAL -->
<div id="qr-notif-overlay" style="display:none;">
  <div class="qr-notif-box">
    <div class="qr-notif-title">üí≥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div>
    <div class="qr-notif-name" id="qrn-name"></div>
    <div class="qr-notif-amount" id="qrn-amount"></div>
    <img class="qr-notif-img" id="qrn-img" src="" alt="QR" style="pointer-events:none;">
    <div class="qr-notif-items" id="qrn-items"></div>
    <div style="display:flex;gap:8px;margin-top:6px;">
      <button id="qrn-save-btn" onclick="saveQrImage()" style="flex:1;background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:11px;font-family:'Kanit',sans-serif;font-size:13px;font-weight:600;color:var(--text);cursor:pointer;">
        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å QR
      </button>
      <button id="qrn-copy-btn" onclick="copyPromptPay()" style="flex:1;background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:11px;font-family:'Kanit',sans-serif;font-size:13px;font-weight:600;color:var(--text);cursor:pointer;">
        üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç
      </button>
    </div>
    <button class="qr-notif-close" onclick="dismissQrNotif()">‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
  </div>
</div>

<div class="modal-overlay" id="modal-overlay" onclick="closeModalIfOutside(event)">
  <div class="modal-box">
    <div class="modal-header">
      <h3>‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body" id="modal-body"></div>
    <div class="modal-footer">
      <button class="modal-cancel" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="modal-submit" id="modal-submit-btn" onclick="submitOrder()">üì§ ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxbqpxW808gr-iWr-4KNN8qTCLsfYN2nXBxvaWlU31Xj6FnsXgMqP01s_od_A5zr-0W/exec';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentUser = '';
let localCart   = {};
// Dynamic menu: [{restaurant, restaurantEmoji, category, id, name, desc, price, emoji, tag}]
let menuData    = [];
let menuMap     = {}; // id‚Üíitem, always in sync with menuData
// Admin editing copy
let editingMenus = {}; // {restName: {emoji, categories: {catName: [{id,name,desc,price,emoji,tag}]}}}
let adminRows   = [];

// emoji callback
let emojiPickerTarget = null; // { type:'rest'|'item', restKey, catKey, idx }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  JSONP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function jsonpFetch(url) {
  return new Promise((resolve, reject) => {
    const cb = '_cb' + Date.now() + Math.random().toString(36).slice(2);
    const script = document.createElement('script');
    const timer = setTimeout(() => {
      delete window[cb];
      if (script.parentNode) script.parentNode.removeChild(script);
      reject(new Error('timeout'));
    }, 20000);
    window[cb] = data => {
      clearTimeout(timer);
      delete window[cb];
      // ‡∏•‡∏ö script ‡∏´‡∏•‡∏±‡∏á resolve ‡πÄ‡∏™‡∏°‡∏≠ ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Å‡πà‡∏≠‡∏ô
      setTimeout(() => { if (script.parentNode) script.parentNode.removeChild(script); }, 0);
      resolve(data);
    };
    script.onerror = () => {
      clearTimeout(timer);
      delete window[cb];
      if (script.parentNode) script.parentNode.removeChild(script);
      reject(new Error('script error'));
    };
    script.src = url + (url.includes('?') ? '&' : '?') + 'callback=' + cb;
    document.head.appendChild(script);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  REGISTER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('name-input').addEventListener('keydown', e => { if (e.key === 'Enter') doRegister(); });

function doRegister() {
  const val = document.getElementById('name-input').value.trim();
  if (!val) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô', 'error'); return; }
  currentUser = val;
  localStorage.setItem('food_order_name', currentUser);
  document.getElementById('display-name').textContent = currentUser;
  showPage('page-menu');
  renderAllGrids();
  startQrPolling();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  EDIT NAME
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function editName() {
  document.getElementById('edit-name-input').value = currentUser;
  document.getElementById('edit-name-overlay').classList.add('show');
  setTimeout(() => document.getElementById('edit-name-input').focus(), 80);
}
function closeEditName() { document.getElementById('edit-name-overlay').classList.remove('show'); }
function closeEditNameIfOutside(e) { if (e.target.id === 'edit-name-overlay') closeEditName(); }
function saveName() {
  const val = document.getElementById('edit-name-input').value.trim();
  if (!val) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô', 'error'); return; }
  currentUser = val;
  localStorage.setItem('food_order_name', currentUser);
  document.getElementById('display-name').textContent = currentUser;
  closeEditName();
  showToast('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß', 'success');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0, 0);
}
function goBack() { showPage('page-menu'); }
function goToAllOrders() { showPage('page-allorders'); refreshAllOrders(); }
function goToAdmin() { showPage('page-admin'); loadAdminPriceTab(); }
function switchAdminTab(id, btn) {
  document.querySelectorAll('.admin-tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.admin-tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
  if (id === 'admin-menu-tab') renderMenuEditor();
}
function refreshAdminTab() {
  const active = document.querySelector('.admin-tab-content.active');
  if (active && active.id === 'admin-menu-tab') loadMenusFromSheet();
  else loadAdminPriceTab();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BUILD MENU TABS FROM DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildMenuFromData(data) {
  // ‡∏Å‡∏£‡∏≠‡∏á custom items ‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà build
  const cleanData = data.filter(i => !i.isCustom);
  data = cleanData;
  // ‡πÄ‡∏û‡∏¥‡πà‡∏° "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©" ‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Sheets)
  const restaurants = [...new Set(data.map(i=>i.restaurant))];
  const customs = restaurants.map(rest => {
    const sample = data.find(i=>i.restaurant===rest)||{};
    return {
      id: 'custom_'+rest.replace(/[^a-zA-Z0-9]/g,''),
      restaurant: rest,
      restaurantEmoji: sample.restaurantEmoji||'üçΩÔ∏è',
      category: '‚úèÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©',
      name: '',           // blank ‚Äî user types it
      desc: '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏≠‡∏á',
      price: 0,
      emoji: '‚úèÔ∏è',
      tag: '',
      isCustom: true
    };
  });
  const allData = [...data, ...customs];
  menuData = allData;
  menuMap = {};
  allData.forEach(function(i){ menuMap[i.id] = i; });
  const tabsEl    = document.getElementById('menu-tabs');
  const contentsEl = document.getElementById('menu-tab-contents');
  tabsEl.innerHTML = '';
  contentsEl.innerHTML = '';

  if (!data.length) {
    contentsEl.innerHTML = '<div class="empty-menu-hint">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π ‚Äî ‡πÑ‡∏õ‡∏ó‡∏µ‡πà üîß Admin ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡πà‡∏≠‡∏ô</div>';
    return;
  }

  // Group: restaurant -> category -> items
  const restMap = {};
  for (const item of allData) {
    if (!restMap[item.restaurant]) restMap[item.restaurant] = { emoji: item.restaurantEmoji||'üçΩÔ∏è', cats: {} };
    if (!restMap[item.restaurant].cats[item.category]) restMap[item.restaurant].cats[item.category] = [];
    restMap[item.restaurant].cats[item.category].push(item);
  }

  let first = true;
  for (const [restName, restVal] of Object.entries(restMap)) {
    const tabId = 'tab-' + restName.replace(/[^a-zA-Z0-9‡∏Å-‡πô]/g,'_');
    // Tab button
    const btn = document.createElement('button');
    btn.className = 'tab-btn' + (first ? ' active' : '');
    btn.innerHTML = restVal.emoji + ' ' + restName;
    btn.onclick = function() { switchMenuTab(tabId, btn); };
    tabsEl.appendChild(btn);

    // Tab content
    const cont = document.createElement('div');
    cont.className = 'tab-content' + (first ? ' active' : '');
    cont.id = tabId;
    let html = '';
    for (const [catName, items] of Object.entries(restVal.cats)) {
      html += '<div class="section-title">' + catName + '</div>';
      html += '<div class="menu-grid" id="grid-' + escId(restName + '_' + catName) + '">';
      html += items.map(item => cardHTML(item)).join('');
      html += '</div>';
    }
    cont.innerHTML = html;
    contentsEl.appendChild(cont);
    first = false;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SPIN WHEEL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê


let _spinItems = [];
let _spinAngle = 0;
let _spinning  = false;

function openSpinModal() {
  document.getElementById('spin-modal-overlay').style.display = 'flex';
  document.querySelectorAll('.bottom-bar,.topbar').forEach(el=>el.style.display='none');
  // init wheel with current menu
  const items = (menuData||[]).filter(i=>!i.isCustom && i.name && i.price > 0);
  setTimeout(()=>initSpinWheel(items), 50);
}
function closeSpinModal() {
  document.getElementById('spin-modal-overlay').style.display = 'none';
  document.querySelectorAll('.bottom-bar,.topbar').forEach(el=>el.style.display='');
}

function initSpinWheel(items) {
  _spinItems = items;
  if (!_spinItems.length) return;
  _spinAngle = 0;
  drawWheel(_spinAngle);
}

const WHEEL_COLORS = [
  ['#f5a623','#1a0e00'],['#e05c3c','#fff'],['#e8832a','#1a0e00'],
  ['#c0392b','#fff'],['#f5a623','#1a0e00'],['#e05c3c','#fff'],
  ['#e8832a','#1a0e00'],['#c0392b','#fff'],['#f5a623','#1a0e00'],
  ['#e05c3c','#fff'],['#e8832a','#1a0e00'],['#c0392b','#fff'],
];

function drawWheel(angle) {
  const canvas = document.getElementById('spin-canvas');
  if (!canvas || !_spinItems.length) return;
  const ctx = canvas.getContext('2d');
  const cx = 130, cy = 130, r = 126;
  const n = Math.min(_spinItems.length, 12);
  const items = _spinItems.slice(0, n);
  const arc = (Math.PI * 2) / n;
  ctx.clearRect(0,0,260,260);

  items.forEach((item, i) => {
    const [bg, fg] = WHEEL_COLORS[i % WHEEL_COLORS.length];
    const start = angle + arc * i - Math.PI/2;
    const end   = start + arc;
    // Slice
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, r, start, end);
    ctx.closePath();
    ctx.fillStyle = bg;
    ctx.fill();
    ctx.strokeStyle = '#3a1a00';
    ctx.lineWidth = 1.5;
    ctx.stroke();
    // Text
    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(start + arc / 2);
    ctx.textAlign = 'right';
    ctx.fillStyle = fg;
    ctx.font = 'bold 11px Kanit,sans-serif';
    const label = (item.emoji||'üçΩÔ∏è') + ' ' + (item.name.length > 8 ? item.name.slice(0,8)+'‚Ä¶' : item.name);
    ctx.fillText(label, r - 8, 4);
    ctx.restore();
  });

  // Center circle
  ctx.beginPath();
  ctx.arc(cx, cy, 22, 0, Math.PI*2);
  ctx.fillStyle = '#f5a623';
  ctx.fill();
  ctx.strokeStyle = '#3a1a00';
  ctx.lineWidth = 2;
  ctx.stroke();
  ctx.beginPath();
  ctx.arc(cx, cy, 12, 0, Math.PI*2);
  ctx.fillStyle = '#c0392b';
  ctx.fill();
}

function spinWheel() {
  if (_spinning || !_spinItems.length) return;
  _spinning = true;
  document.getElementById('spin-btn').disabled = true;
  document.getElementById('spin-result').style.display = 'none';

  const n = Math.min(_spinItems.length, 12);
  const extraSpins = (5 + Math.floor(Math.random()*5)) * Math.PI * 2;
  const targetSlice = Math.floor(Math.random() * n);
  const arc = (Math.PI * 2) / n;
  // Pointer is at top (‚àíœÄ/2), so target angle makes targetSlice center point up
  const targetAngle = -(arc * targetSlice + arc/2) + Math.PI/2;
  const totalRotation = extraSpins + ((targetAngle - _spinAngle) % (Math.PI*2));

  const start = performance.now();
  const duration = 3500;
  const startAngle = _spinAngle;

  function easeOut(t) { return 1 - Math.pow(1-t, 4); }

  function frame(now) {
    const t = Math.min((now - start) / duration, 1);
    _spinAngle = startAngle + totalRotation * easeOut(t);
    drawWheel(_spinAngle);
    if (t < 1) {
      requestAnimationFrame(frame);
    } else {
      _spinAngle = startAngle + totalRotation;
      drawWheel(_spinAngle);
      _spinning = false;
      document.getElementById('spin-btn').disabled = false;
      showSpinResult(_spinItems[targetSlice]);
    }
  }
  requestAnimationFrame(frame);
}

function showSpinResult(item) {
  const el = document.getElementById('spin-result');
  if (!el) return;
  el.style.display = 'block';
  el.innerHTML =
    '<div class="spin-result-emoji">'+(item.emoji||'üçΩÔ∏è')+'</div>'+
    '<div class="spin-result-name">'+item.name+'</div>'+
    '<div class="spin-result-rest">'+item.restaurant+'</div>'+
    '<div class="spin-result-price">‡∏ø'+item.price+'</div>'+
    '<button class="spin-add-btn" onclick="addSpinToCart(this)" data-id="'+item.id+'">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>';
}

function addSpinToCart(btn) {
  const itemId = btn.dataset ? btn.dataset.id : btn;
  const item = menuMap[itemId];
  if (!item) return;
  chg(itemId, 1);
  showToast('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° '+item.name+' ‡πÅ‡∏•‡πâ‡∏ß', 'success');
  document.getElementById('spin-result').style.display = 'none';
}

function escId(s) { return s.replace(/[^a-zA-Z0-9‡∏Å-‡πô]/g,'_'); }

function switchMenuTab(tabId, btn) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('#menu-tabs .tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  btn.classList.add('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RENDER MENU CARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const TAG_LABEL = { rec:'‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥', hot:'‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°', new:'‡πÉ‡∏´‡∏°‡πà' };

// Build HTML for one variant button ‚Äî avoids nested quote hell
function variantBtnHTML(itemId, vi, label, price, qty) {
  const enc = encodeURIComponent(label);
  const minusBtn = qty > 0
    ? '<button class="qty-btn" style="width:22px;height:22px;font-size:14px;" ' +
        'onclick="chgVariant(\'' + itemId + '\',' + vi + ',-1,\'' + enc + '\',' + price + ')">‚àí</button>' +
        '<span class="qty-num">' + qty + '</span>'
    : '';
  const plusBtn = '<button class="qty-btn add" style="width:22px;height:22px;font-size:14px;" ' +
    'onclick="chgVariant(\'' + itemId + '\',' + vi + ',1,\'' + enc + '\',' + price + ')">+</button>';
  return '<div class="variant-btn' + (qty > 0 ? ' selected' : '') + '">' +
    '<span class="vb-label">' + label + '</span>' +
    '<span class="vb-price">‡∏ø' + price + '</span>' +
    '<div class="qty-ctrl" style="margin-top:4px;">' + minusBtn + plusBtn + '</div>' +
    '</div>';
}

function cardHTML(item) {
  // Custom blank item ‚Äî render input fields
  if (item.isCustom) {
    const cid = item.id;
    return '<div class="food-card" id="card-'+cid+'" style="border:1.5px dashed rgba(245,166,35,0.3);">'+
      '<div style="padding:12px 14px;">'+
        '<div style="font-size:12px;font-weight:600;color:var(--text2);margin-bottom:8px;">‚úèÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏© / ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á</div>'+
        '<input id="cname-'+cid+'" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£..." '+
          'style="width:100%;background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:7px 10px;font-family:Kanit,sans-serif;font-size:13px;color:var(--text);margin-bottom:6px;box-sizing:border-box;">'+
        '<div style="display:flex;gap:8px;align-items:center;">'+
          '<input id="cprice-'+cid+'" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ø" min="0" '+
            'style="width:90px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:7px 10px;font-family:Kanit,sans-serif;font-size:13px;color:var(--text);">'+
          '<button onclick="addCustomItem(this)" data-cid="'+cid+'" '+
            'style="flex:1;background:var(--green);border:none;border-radius:8px;padding:8px;font-family:Kanit,sans-serif;font-size:13px;font-weight:600;color:white;cursor:pointer;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>'+
        '</div>'+
      '</div>'+
    '</div>';
  }
  const hasVariants = item.variants && item.variants.length > 0;
  const tag = item.tag ? '<span class="tag tag-'+item.tag+'">'+(TAG_LABEL[item.tag]||'')+'</span>' : '';

  if (hasVariants) {
    let varBtns = '<div class="variant-btns">';
    item.variants.forEach(function(v, vi) {
      const cartKey = item.id + '__v' + vi;
      const ci = localCart[cartKey];
      const qty = ci ? ci.qty : 0;
      varBtns += variantBtnHTML(item.id, vi, v.label, v.price, qty);
    });
    varBtns += '</div>';
    const anyInCart = item.variants.some(function(_,vi){ return !!localCart[item.id+'__v'+vi]; });
    const firstCart = item.variants.map(function(_,vi){ return localCart[item.id+'__v'+vi]; }).find(function(c){ return c; });
    const note = firstCart ? (firstCart.note||'') : '';
    return '<div class="menu-card '+(anyInCart?'in-cart':'')+' " id="card-'+item.id+'">' +
      '<div class="menu-emoji">'+item.emoji+'</div>' +
      '<div class="menu-info" style="flex:1">' +
        '<div class="menu-name">'+item.name+tag+'</div>' +
        (item.desc?'<div class="menu-desc">'+item.desc+'</div>':'') +
        varBtns +
        '<div class="note-row '+(anyInCart?'visible':'')+' " id="nr-'+item.id+'">' +
          '<input class="note-input" type="text" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..." value="'+note+'" ' +
          'onchange="updateNoteAll(\''+item.id+'\','+item.variants.length+',this.value)">' +
        '</div>' +
      '</div>' +
    '</div>';
  }


  // Single price
  const ci = localCart[item.id];
  const qty = ci ? ci.qty : 0;
  const note = ci ? (ci.note||'') : '';
  const ic = qty > 0;
  return '<div class="menu-card '+(ic?'in-cart':'')+'" id="card-'+item.id+'">'+
    '<div class="menu-emoji">'+item.emoji+'</div>'+
    '<div class="menu-info">'+
      '<div class="menu-name">'+item.name+tag+'</div>'+
      (item.desc?'<div class="menu-desc">'+item.desc+'</div>':'')+
      '<div class="menu-price">‡∏ø'+item.price+'</div>'+
      '<div class="note-row '+(ic?'visible':'')+'" id="nr-'+item.id+'">'+
        '<input class="note-input" type="text" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ ‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡πÄ‡∏ú‡πá‡∏î..." value="'+note+'" onchange="updateNote(\''+item.id+'\',this.value)">'+
      '</div>'+
    '</div>'+
    '<div class="qty-ctrl">'+
      (qty>0?'<button class="qty-btn" onclick="chg(\''+item.id+'\',-1)">‚àí</button><span class="qty-num">'+qty+'</span>':'')+
      '<button class="qty-btn add" onclick="chg(\''+item.id+'\',1)">+</button>'+
    '</div>'+
  '</div>';
}

function renderAllGrids() {
  buildMenuFromData(menuData);
  updateBadge();
}

function refreshCard(itemId) {
  const item = menuMap[itemId];
  if (!item) return;
  const el = document.getElementById('card-'+itemId);
  if (!el) return;

  if (item.variants && item.variants.length > 0) {
    // Re-render variant buttons only
    let varHTML = '<div class="variant-btns">';
    item.variants.forEach(function(v, vi) {
      const qty = (localCart[itemId+'__v'+vi] || {qty:0}).qty;
      varHTML += variantBtnHTML(itemId, vi, v.label, v.price, qty);
    });
    varHTML += '</div>';
    const vb = el.querySelector('.variant-btns');
    if (vb) vb.outerHTML = varHTML;
    const anyInCart = item.variants.some(function(_,vi){ return !!localCart[itemId+'__v'+vi]; });
    el.classList.toggle('in-cart', anyInCart);
    const nr = el.querySelector('.note-row');
    if (nr) nr.classList.toggle('visible', anyInCart);
  } else {
    // Single-price: patch qty-ctrl only
    const ci = localCart[itemId];
    const qty = ci ? ci.qty : 0;
    el.classList.toggle('in-cart', qty > 0);
    const nr = document.getElementById('nr-'+itemId);
    if (nr) nr.classList.toggle('visible', qty > 0);
    const qc = el.querySelector('.qty-ctrl');
    if (!qc) return;
    const esc = String(itemId).replace(/'/g,"\\'");
    qc.innerHTML =
      (qty > 0
        ? '<button class="qty-btn" onclick="chg(&#39;'+esc+'&#39;,-1)">‚àí</button>' +
          '<span class="qty-num">'+qty+'</span>'
        : '') +
      '<button class="qty-btn add" onclick="chg(&#39;'+esc+'&#39;,1)">+</button>';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CART
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addCustomItem(btn) {
  const cid = btn.dataset ? btn.dataset.cid : btn;
  const nameEl  = document.getElementById('cname-'+cid);
  const priceEl = document.getElementById('cprice-'+cid);
  if (!nameEl || !priceEl) return;
  const name  = nameEl.value.trim();
  const price = Number(priceEl.value)||0;
  if (!name) { nameEl.focus(); showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£','error'); return; }
  if (!price) { priceEl.focus(); showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤','error'); return; }

  // Get restaurant from custom item
  const meta = menuMap[cid];
  if (!meta) return;

  // Create unique id for this custom entry
  const uid = 'cx_'+Date.now()+'_'+Math.random().toString(36).slice(2,5);
  localCart[uid] = {
    qty: 1, price, name,
    emoji: '‚úèÔ∏è',
    restaurant: meta.restaurant,
    note: ''
  };
  // Clear inputs
  nameEl.value = ''; priceEl.value = '';
  updateMyStats(); updateBadge();
  showToast('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° '+name+' ‡∏ø'+price+' ‡πÅ‡∏•‡πâ‡∏ß','success');
}

function chg(itemId, delta) {
  const meta = menuMap[itemId];
  if (!meta) return;
  const cur = localCart[itemId] ? localCart[itemId].qty : 0;
  const nq  = Math.max(0, cur + delta);
  if (nq === 0) { delete localCart[itemId]; }
  else { localCart[itemId] = { qty:nq, price:Number(meta.price), name:meta.name, emoji:meta.emoji, restaurant:meta.restaurant, note:localCart[itemId]?localCart[itemId].note:'' }; }
  refreshCard(itemId);
  updateMyStats();
  updateBadge();
}

function chgVariant(itemId, vi, delta, labelEnc, price) {
  const meta = menuMap[itemId];
  if (!meta) return;
  const label = decodeURIComponent(labelEnc);
  const cartKey = itemId + '__v' + vi;
  const cur = localCart[cartKey] ? localCart[cartKey].qty : 0;
  const nq  = Math.max(0, cur + delta);
  if (nq === 0) { delete localCart[cartKey]; }
  else { localCart[cartKey] = { qty:nq, price:Number(price), name:meta.name+' ('+label+')', emoji:meta.emoji, restaurant:meta.restaurant, note:localCart[cartKey]?localCart[cartKey].note:'' }; }
  refreshCard(itemId);
  updateMyStats();
  updateBadge();
}

function updateNote(itemId, val) { if (localCart[itemId]) localCart[itemId].note = val; }
function updateNoteAll(itemId, count, val) {
  for (let vi = 0; vi < count; vi++) {
    const ck = itemId + '__v' + vi;
    if (localCart[ck]) localCart[ck].note = val;
  }
}

function updateMyStats() {
  let count=0, total=0;
  for (const it of Object.values(localCart)) { count+=it.qty; total+=it.qty*it.price; }
  document.getElementById('my-item-count').textContent = count;
  document.getElementById('my-total').textContent = '‡∏ø'+total;
  document.getElementById('confirm-btn').disabled = (count===0);
}
function updateBadge() {
  let t=0; for (const it of Object.values(localCart)) t+=it.qty;
  document.getElementById('cart-badge').textContent = t;
}
function updateOrdersBadge(rows) {
  // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô rows ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Sheets ‡∏ö‡∏ô badge ‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  const total = (rows||[]).reduce((s,r)=>s+(Number(r.qty)||0), 0);
  const el = document.getElementById('cart-badge');
  if (el) el.textContent = total;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONFIRM MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openConfirmModal() {
  const items = Object.values(localCart).filter(i=>i.qty>0);
  if (!items.length) return;
  let rows='', total=0;
  for (const it of items) {
    const line=it.qty*it.price; total+=line;
    rows+='<div class="modal-item-row">'+
      '<div class="mi-emoji">'+it.emoji+'</div>'+
      '<div class="mi-info"><div class="mi-name">'+it.name+'</div>'+
      '<div class="mi-sub">üìç '+it.restaurant+(it.note?' ¬∑ üìù '+it.note:'')+'</div></div>'+
      '<div class="mi-right"><div class="mi-qty">√ó '+it.qty+'</div><div class="mi-price">‡∏ø'+line+'</div></div>'+
      '</div>';
  }
  document.getElementById('modal-body').innerHTML =
    '<p style="font-size:12px;color:var(--text2);margin-bottom:11px;">‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á: <strong style="color:var(--accent)">üë§ '+currentUser+'</strong></p>'+
    rows+'<div class="modal-total"><span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</span><strong>‡∏ø'+total+'</strong></div>';
  document.getElementById('modal-submit-btn').disabled = false;
  document.getElementById('modal-submit-btn').innerHTML = 'üì§ ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
  document.getElementById('modal-overlay').classList.add('show');
}
function closeModal() { document.getElementById('modal-overlay').classList.remove('show'); }
function closeModalIfOutside(e) { if (e.target.id==='modal-overlay') closeModal(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SUBMIT ORDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function submitOrder() {
  const items = Object.values(localCart).filter(i=>i.qty>0);
  if (!items.length) return;
  const btn = document.getElementById('modal-submit-btn');
  btn.disabled=true; btn.innerHTML='‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';
  const payload = { person:currentUser, items:items.map(i=>({name:i.name,emoji:i.emoji,qty:i.qty,price:i.price,note:i.note||'',restaurant:i.restaurant||''})) };
  try {
    await fetch(SCRIPT_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'text/plain'},body:JSON.stringify(payload)});
    localCart={};
    renderAllGrids(); updateMyStats(); updateBadge(); closeModal();
    showToast('‚úÖ ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!','success');
  } catch(err) {
    btn.disabled=false; btn.innerHTML='üì§ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
    showToast('‚ùå ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','error');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ALL ORDERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function refreshAllOrders() {
  const el = document.getElementById('allorders-content');
  el.innerHTML = '<div class="loading-state"><div class="spinner"></div><br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
  try {
    const json = await jsonpFetch(SCRIPT_URL+'?action=get');
    renderAllOrdersTable(json.rows||[], el);
  } catch(e) {
    el.innerHTML = '<div class="empty-state"><div class="empty-icon">‚ùå</div><p>‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: '+e.message+'</p></div>';
  }
}
function renderAllOrdersTable(rows, container) {
  if (!rows.length) {
    container.innerHTML='<div class="empty-state"><div class="empty-icon">üçΩÔ∏è</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p></div>';
    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ orders ‡πÅ‡∏•‡πâ‡∏ß ‡∏•‡πâ‡∏≤‡∏á QR cards ‡∏î‡πâ‡∏ß‡∏¢
    localStorage.removeItem('admin_qr_state');
    localStorage.removeItem('admin_paid');
    const wrap = document.getElementById('qr-cards-wrap');
    if (wrap) wrap.innerHTML = '';
    return;
  }
  const grouped={};
  for (const r of rows) { if (!grouped[r.person]) grouped[r.person]=[]; grouped[r.person].push(r); }
  let gt=0, gq=0;
  const trs = rows.map(r => {
    const line=Number(r.total)||(Number(r.qty)*Number(r.price)); gt+=line; gq+=Number(r.qty);
    return '<tr>'+
      '<td><div class="td-food"><div class="td-food-emoji">'+(r.emoji||'üçΩÔ∏è')+'</div><div>'+
      '<div class="td-food-name">'+r.name+'</div>'+(r.note?'<div class="td-food-note">üìù '+r.note+'</div>':'')+
      '</div></div></td>'+
      '<td class="center"><span class="td-qty">'+r.qty+'</span></td>'+
      '<td class="center"><span class="td-price">'+line+'</span></td>'+
      '<td class="center"><span class="td-person">üë§ '+r.person+'</span></td>'+
      '<td class="center"><span class="td-restaurant">'+(r.restaurant||'')+'</span></td>'+
      '<td class="center"><span class="td-time">'+r.timestamp+'</span></td>'+
      '</tr>';
  }).join('');
  const personSums = Object.entries(grouped).map(([person,items]) => {
    const sub=items.reduce((s,r)=>s+(Number(r.total)||(Number(r.qty)*Number(r.price))),0);
    return '<div class="person-sum-pill"><span class="td-person">üë§ '+person+'</span><span class="person-sum-price">‡∏ø'+sub+'</span></div>';
  }).join('');
  updateOrdersBadge(rows);
  container.innerHTML =
    '<div class="order-table-wrap"><table class="order-table"><thead><tr>'+
    '<th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</th><th class="center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th class="center">‡∏£‡∏≤‡∏Ñ‡∏≤</th><th class="center">‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á</th><th class="center">‡∏£‡πâ‡∏≤‡∏ô</th><th class="center">‡πÄ‡∏ß‡∏•‡∏≤</th>'+
    '</tr></thead><tbody>'+trs+'</tbody></table>'+
    '<div class="table-footer">'+
    '<div style="display:flex;gap:14px;flex-wrap:wrap;"><span class="stat-pill">üë• <strong>'+Object.keys(grouped).length+'</strong> ‡∏Ñ‡∏ô</span><span class="stat-pill">üçΩÔ∏è <strong>'+gq+'</strong> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></div>'+
    '<div class="table-footer-total">‡∏ø'+gt+'</div></div></div>'+
    '<div class="person-sums-wrap">'+personSums+'</div>'+
    '<button class="clear-btn" onclick="clearAllSheetOrders()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà)</button>';
}
async function clearAllSheetOrders() {
  if (!confirm('‚ö†Ô∏è ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Google Sheets ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?\n(‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ)')) return;
  try {
    // clearNotifs ‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ user poll ‡πÄ‡∏à‡∏≠‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏¥‡∏î popup
    await jsonpFetch(SCRIPT_URL+'?action=clearNotifs').catch(()=>{});
    await jsonpFetch(SCRIPT_URL+'?action=clear');
    localStorage.removeItem('admin_paid');
    localStorage.removeItem('admin_qr_state');
    localStorage.removeItem('qr_seen_ts_' + currentUser);
    showToast('üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß','success');
    refreshAllOrders();
  }
  catch(e) { showToast('‚ùå ‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','error'); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ADMIN PRICE TAB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadAdminPriceTab() {
  const el = document.getElementById('admin-orders-content');
  document.getElementById('admin-qr-section').style.display='none';
  document.getElementById('admin-confirm-bar').style.display='none';
  el.innerHTML='<div class="loading-state"><div class="spinner"></div><br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
  const savedPhone=localStorage.getItem('food_order_phone');
  if (savedPhone) document.getElementById('admin-phone').value=savedPhone;
  fetchPhoneFromSheet();
  try {
    const json=await jsonpFetch(SCRIPT_URL+'?action=get');
    adminRows=json.rows||[];
    renderAdminTable(adminRows,el);
    restoreQrSection();
  } catch(e) { el.innerHTML='<div class="empty-state"><div class="empty-icon">‚ùå</div><p>‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p></div>'; }
}

function restoreQrSection() {
  let qrState = {};
  try { qrState = JSON.parse(localStorage.getItem('admin_qr_state') || '{}'); } catch(e) {}
  if (!Object.keys(qrState).length) return;

  let paidMap = {};
  try { paidMap = JSON.parse(localStorage.getItem('admin_paid') || '{}'); } catch(e) {}

  const wrap = document.getElementById('qr-cards-wrap');
  wrap.innerHTML = '';

  Object.entries(qrState).forEach(([person, data]) => {
    try {
      const personId = person.replace(/[^a-zA-Z0-9‡∏Å-‡πô]/g,'_');
      const isPaid = !!paidMap[person];
      const itemRows = (data.items||[]).map(it =>
        '<div class="qr-item-row">'+
          '<span class="qr-item-name">'+(it.emoji||'üçΩÔ∏è')+' '+(it.name||'')+' √ó'+(it.qty||0)+'</span>'+
          '<span>‡∏ø'+(it.actual||0)+'</span>'+
        '</div>'
      ).join('');
      const card = document.createElement('div');
      card.className = 'qr-card' + (isPaid ? ' paid' : '');
      card.setAttribute('data-person', person);
      card.innerHTML =
        '<div class="qr-card-header">'+
          '<div class="qr-card-name">üë§ '+person+'</div>'+
          '<div class="qr-card-amount">‡∏ø'+(data.amount||0)+'</div>'+
          '<div id="paid-badge-'+personId+'">'+(isPaid ? '<span class="qr-paid-badge">‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</span>' : '')+'</div>'+
        '</div>'+
        '<div class="qr-img-wrap">'+
          '<a href="'+(data.qrUrl||'')+'" target="_blank">'+
            '<img src="'+(data.qrUrl||'')+'" alt="QR" style="width:180px;height:180px;">'+
          '</a>'+
        '</div>'+
        '<div class="qr-items-list">'+itemRows+'</div>'+
        '<div style="display:flex;gap:8px;margin:0 14px 14px;">'+
          '<button class="qr-save-btn" style="flex:1" onclick="downloadQR(this.dataset.url,this.dataset.fn)" data-url="'+(data.qrUrl||'')+'" data-fn="QR_'+person+'_'+(data.amount||0)+'THB.png">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å QR</button>'+
          '<button class="qr-save-btn" style="flex:1;background:rgba(124,174,255,0.15);color:var(--blue);border:1px solid rgba(124,174,255,0.3);" onclick="window.open(this.dataset.url)" data-url="'+(data.qrUrl||'').replace('.png','')+'">üîó ‡πÄ‡∏õ‡∏¥‡∏î QR</button>'+
        '</div>';
      wrap.appendChild(card);
    } catch(err) { console.error('restoreQrSection card error:', person, err); }
  });

  // Always show section if we have state, even if some cards failed
  document.getElementById('admin-qr-section').style.display = 'block';

  // Resume polling for unpaid
  const unpaid = Object.keys(qrState).filter(p => !paidMap[p]);
  if (unpaid.length) startAdminAckPolling(unpaid, '0');
}
function renderAdminTable(rows,container) {
  if (!rows.length) { container.innerHTML='<div class="empty-state"><div class="empty-icon">üçΩÔ∏è</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p></div>'; document.getElementById('admin-confirm-bar').style.display='none'; return; }
  const trs=rows.map((r,idx)=>{
    const orig=Number(r.total)||(Number(r.qty)*Number(r.price));
    return '<tr>'+
      '<td><div class="td-food"><div class="td-food-emoji">'+(r.emoji||'üçΩÔ∏è')+'</div><div>'+
      '<div class="td-food-name">'+r.name+'</div>'+(r.note?'<div class="td-food-note">üìù '+r.note+'</div>':'')+
      '</div></div></td>'+
      '<td class="center"><span class="td-qty">'+r.qty+'</span></td>'+
      '<td class="center"><span class="td-person">üë§ '+r.person+'</span></td>'+
      '<td class="center"><span class="td-restaurant">'+(r.restaurant||'')+'</span></td>'+
      '<td class="center">'+
        '<div class="admin-price-orig">‡∏ø'+orig+'</div>'+
        '<input class="admin-price-input" type="number" id="aprice-'+idx+'" value="'+orig+'" min="0" oninput="onAdminPriceChange('+idx+',this)">'+
      '</td></tr>';
  }).join('');
  container.innerHTML='<div class="admin-table-wrap"><table class="admin-table"><thead><tr>'+
    '<th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</th><th class="center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th class="center">‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á</th><th class="center">‡∏£‡πâ‡∏≤‡∏ô</th><th class="center">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏£‡∏¥‡∏á (‡∏ø)</th>'+
    '</tr></thead><tbody>'+trs+'</tbody></table></div>';
  document.getElementById('admin-confirm-bar').style.display='flex';
  updateAdminGrandTotal();
}
function onAdminPriceChange(idx,input) {
  const orig=Number(adminRows[idx].total)||(Number(adminRows[idx].qty)*Number(adminRows[idx].price));
  input.classList.toggle('changed',Number(input.value)!==orig);
  updateAdminGrandTotal();
}
function updateAdminGrandTotal() {
  let total=0;
  adminRows.forEach((_,idx)=>{ const inp=document.getElementById('aprice-'+idx); total+=inp?(Number(inp.value)||0):0; });
  const el=document.getElementById('admin-grand-total');
  if (el) el.textContent='‡∏ø'+total;
}
function confirmAdminPrices() {
  const phone=document.getElementById('admin-phone').value.trim().replace(/\D/g,'');
  if (!phone||phone.length<9) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå PromptPay ‡∏Å‡πà‡∏≠‡∏ô','error'); return; }
  savePhone(phone);
  const personData={};
  adminRows.forEach((r,idx)=>{
    const inp=document.getElementById('aprice-'+idx);
    const actual=inp?(Number(inp.value)||0):0;
    const orig=Number(r.total)||(Number(r.qty)*Number(r.price));
    if (!personData[r.person]) personData[r.person]={total:0,items:[]};
    personData[r.person].total+=actual;
    personData[r.person].items.push({emoji:r.emoji||'üçΩÔ∏è',name:r.name,qty:r.qty,orig,actual});
  });
  const wrap=document.getElementById('qr-cards-wrap');
  wrap.innerHTML='';

  // Load paid set from localStorage (persists across refresh)
  // Key: 'admin_paid' = JSON {person: notifTs} meaning this person paid at this ts
  let paidMap = {};
  try { paidMap = JSON.parse(localStorage.getItem('admin_paid') || '{}'); } catch(e) {}

  Object.entries(personData).forEach(([person,data])=>{
    const amount=data.total;
    const qrUrl='https://promptpay.io/'+phone+'/'+amount;
    const personId=person.replace(/[^a-zA-Z0-9‡∏Å-‡πô]/g,'_');
    const itemRows=data.items.map(it=>
      '<div class="qr-item-row"><span class="qr-item-name">'+it.emoji+' '+it.name+' √ó'+it.qty+'</span>'+
      '<span>'+(it.actual!==it.orig?'<s style="color:var(--text3);font-size:10px;">‡∏ø'+it.orig+'</s> ':'')+' ‡∏ø'+it.actual+'</span></div>'
    ).join('');
    const card=document.createElement('div');
    card.className='qr-card' + (paidMap[person] ? ' paid' : '');
    card.setAttribute('data-person', person);
    card.innerHTML=
      '<div class="qr-card-header">'+
        '<div class="qr-card-name">üë§ '+person+'</div>'+
        '<div class="qr-card-amount">‡∏ø'+amount+'</div>'+
        '<div id="paid-badge-'+personId+'">'+(paidMap[person]?'<span class="qr-paid-badge">‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</span>':'')+'</div>'+
      '</div>'+
      '<div class="qr-img-wrap"><a href="'+qrUrl+'.png" target="_blank"><img src="'+qrUrl+'.png" alt="QR" style="width:180px;height:180px;"></a></div>'+
      '<div class="qr-items-list">'+itemRows+'</div>'+
      '<div style="display:flex;gap:8px;margin:0 14px 14px;">'+
        '<button class="qr-save-btn" style="flex:1" onclick="downloadQR(\''+qrUrl+'.png\',\'QR_'+person+'_'+amount+'THB.png\')">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å QR</button>'+
        '<button class="qr-save-btn" style="flex:1;background:rgba(124,174,255,0.15);color:var(--blue);border:1px solid rgba(124,174,255,0.3);" onclick="window.open(\''+qrUrl+'\',\'_blank\')">üîó ‡πÄ‡∏õ‡∏¥‡∏î QR</button>'+
      '</div>';
    wrap.appendChild(card);
  });
  document.getElementById('admin-qr-section').style.display='block';
  document.getElementById('admin-qr-section').scrollIntoView({behavior:'smooth'});

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å QR state ‡∏•‡∏á localStorage ‡πÑ‡∏ß‡πâ restore ‡∏´‡∏•‡∏±‡∏á refresh
  const qrState = {};
  Object.entries(personData).forEach(([person, data]) => {
    qrState[person] = {
      amount: data.total,
      qrUrl: 'https://promptpay.io/' + phone + '/' + data.total + '.png',
      items: data.items
    };
  });
  localStorage.setItem('admin_qr_state', JSON.stringify(qrState));

  // ‡∏™‡πà‡∏á notification ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢
  // ts ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á + random ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ã‡πâ‡∏≥ seenTs ‡πÄ‡∏î‡∏¥‡∏°‡∏ö‡∏ô user device
  const ts = String(Date.now()) + Math.floor(Math.random()*1000);
  // clear seenTs ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å person ‡∏ö‡∏ô device ‡∏ô‡∏µ‡πâ
  Object.keys(personData).forEach(person => {
    localStorage.removeItem('qr_seen_ts_' + person);
  });
  const notifiedPersons = Object.keys(personData);
  Object.entries(personData).forEach(([person, data]) => {
    if (paidMap[person]) return;  // ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡∏Ç‡πâ‡∏≤‡∏°
    const qrUrl    = 'https://promptpay.io/' + phone + '/' + data.total + '.png';
    const notifKey = encodeURIComponent('qr_' + person);
    const ackKey   = encodeURIComponent('qr_ack_' + person);
    const notifVal = JSON.stringify({ person, amount: data.total, qrUrl, ts, items: data.items });
    jsonpFetch(SCRIPT_URL + '?action=saveNotif&key=' + notifKey + '&value=' + encodeURIComponent(notifVal) + '&ts=' + ts).catch(()=>{});
    jsonpFetch(SCRIPT_URL + '?action=saveNotif&key=' + ackKey   + '&value=pending&ts=' + ts).catch(()=>{});
  });

  startAdminAckPolling(notifiedPersons, ts);
  showToast('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß!', 'success');
}

let _adminAckTimer = null;
function markCardPaid(person) {
  const personId = person.replace(/[^a-zA-Z0-9‡∏Å-‡πô]/g,'_');
  const card = document.querySelector('.qr-card[data-person="' + person + '"]');
  if (card && !card.classList.contains('paid')) {
    card.classList.add('paid');
    const badge = document.getElementById('paid-badge-' + personId);
    if (badge) badge.innerHTML = '<span class="qr-paid-badge">‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</span>';
  }
  // Persist to localStorage
  let paidMap = {};
  try { paidMap = JSON.parse(localStorage.getItem('admin_paid') || '{}'); } catch(e) {}
  paidMap[person] = String(Date.now());
  localStorage.setItem('admin_paid', JSON.stringify(paidMap));
}

function startAdminAckPolling(persons, batchTs) {
  if (_adminAckTimer) clearInterval(_adminAckTimer);
  _adminAckTimer = setInterval(async () => {
    let allPaid = true;
    for (const person of persons) {
      const ackKey = encodeURIComponent('qr_ack_' + person);
      try {
        const res = await jsonpFetch(SCRIPT_URL + '?action=getNotif&key=' + ackKey);
        if (res && res.value === 'paid' && res.ts >= batchTs) {
          markCardPaid(person);
        } else {
          allPaid = false;
        }
      } catch(e) { allPaid = false; }
    }
    if (allPaid) { clearInterval(_adminAckTimer); _adminAckTimer = null; }
  }, 5000);
}
function savePhoneNow() {
  const phone = document.getElementById('admin-phone').value.trim().replace(/\D/g,'');
  if (phone && phone.length >= 9) {
    savePhone(phone);
    showToast('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå PromptPay ‡πÅ‡∏•‡πâ‡∏ß', 'success');
  }
}
function savePhone(phone) {
  localStorage.setItem('food_order_phone',phone);
  jsonpFetch(SCRIPT_URL+'?action=savePhone&phone='+encodeURIComponent(phone)).catch(()=>{});
}
async function fetchPhoneFromSheet() {
  try {
    const json=await jsonpFetch(SCRIPT_URL+'?action=getPhone');
    if (json.phone) {
      localStorage.setItem('food_order_phone',json.phone);
      const el=document.getElementById('admin-phone');
      if (el&&!el.value) el.value=json.phone;
    }
  } catch(e) {}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LOAD MENUS FROM SHEET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadMenusFromSheet() {
  const wrap = document.getElementById('menu-editor-wrap');
  if (wrap) wrap.innerHTML = '<div class="loading-state"><div class="spinner"></div><br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π...</div>';
  try {
    const json = await jsonpFetch(SCRIPT_URL+'?action=getMenus');
    const rows = json.rows || [];
    if (rows.length) {
      menuData = rows;
      renderAllGrids();
    }
    buildEditingMenus(rows);
    renderMenuEditor();
  } catch(e) {
    if (wrap) wrap.innerHTML='<div class="empty-state"><div class="empty-icon">‚ùå</div><p>‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p></div>';
    showToast('‚ùå ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: '+e.message,'error');
  }
}

function buildEditingMenus(rows) {
  editingMenus = {};
  for (const r of rows) {
    const rest = r.restaurant || '‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
    const cat  = (r.category && r.category !== 'undefined') ? r.category : '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà';
    if (!editingMenus[rest]) editingMenus[rest] = { emoji: r.restaurantEmoji||'üçΩÔ∏è', categories: {} };
    if (!editingMenus[rest].categories[cat]) editingMenus[rest].categories[cat] = [];
    editingMenus[rest].categories[cat].push({
      id: r.id||('item_'+Date.now()+'_'+Math.random().toString(36).slice(2,6)),
      name: r.name||'', desc: r.desc||'', price: r.price||0,
      emoji: r.emoji||'üçΩÔ∏è', tag: r.tag||'',
      variants: r.variants || []
    });
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MENU EDITOR RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderMenuEditor() {
  const wrap = document.getElementById('menu-editor-wrap');
  if (!wrap) return;

  let html = '<div class="me-toolbar"><h3>üçΩÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π</h3>'+
    '<button class="me-add-rest-btn" onclick="addRestaurant()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡πâ‡∏≤‡∏ô</button></div>';

  // Clean up any "undefined" keys from category names
  for (const rk of Object.keys(editingMenus)) {
    const cats = editingMenus[rk].categories;
    if (cats['undefined']) {
      const items = cats['undefined'];
      delete cats['undefined'];
      cats['‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà'] = cats['‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà'] ? cats['‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà'].concat(items) : items;
    }
  }
  const restKeys = Object.keys(editingMenus);
  if (!restKeys.length) {
    html += '<div class="empty-state"><div class="empty-icon">üè™</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤<br>‡∏Å‡∏î + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡πâ‡∏≤‡∏ô</p></div>';
  } else {
    for (const restKey of restKeys) {
      const rest = editingMenus[restKey];
      const catKeys = Object.keys(rest.categories);
      html += '<div class="me-restaurant-card" id="me-rest-'+escId(restKey)+'">';
      html += '<div class="me-rest-header">'+
        '<button class="me-rest-emoji-btn" onclick="openEmojiPicker({type:\'rest\',restKey:\''+escAttr(restKey)+'\'})">'+rest.emoji+'</button>'+
        '<input class="me-rest-name-input" type="text" value="'+escAttr(restKey)+'" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô" onblur="renameRestaurant(\''+escAttr(restKey)+'\',this.value)" onkeydown="if(event.key===\'Enter\')this.blur()">'+
        '<div class="me-rest-actions">'+
          '<button class="me-icon-btn" onclick="addCategory(\''+escAttr(restKey)+'\')">+ ‡∏´‡∏°‡∏ß‡∏î</button>'+
          '<button class="me-icon-btn danger" onclick="deleteRestaurant(\''+escAttr(restKey)+'\')">üóëÔ∏è</button>'+
        '</div>'+
      '</div>';
      html += '<div class="me-rest-body">';
      for (const catKey of catKeys) {
        const items = rest.categories[catKey];
        html += '<div class="me-category-block" id="me-cat-'+escId(restKey+'_'+catKey)+'">';
        html += '<div class="me-cat-header">'+
          '<input class="me-cat-name-input" type="text" value="'+escAttr(catKey)+'" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà" onblur="renameCategory(\''+escAttr(restKey)+'\',\''+escAttr(catKey)+'\',this.value)" onkeydown="if(event.key===\'Enter\')this.blur()">'+
          '<button class="me-icon-btn danger" onclick="deleteCategory(\''+escAttr(restKey)+'\',\''+escAttr(catKey)+'\')">üóëÔ∏è</button>'+
        '</div>';
        html += '<div class="me-items-list">';
        items.forEach(function(item, idx) {
          const rk = escAttr(restKey), ck = escAttr(catKey);
          const hasVariants = item.variants && item.variants.length > 0;

          // Build variants editor
          let varHtml = '';
          if (hasVariants) {
            varHtml += '<div style="grid-column:1/-1;margin-top:4px;background:rgba(245,166,35,0.05);border-radius:8px;padding:7px 10px;">';
            varHtml += '<div style="font-size:10px;color:var(--text3);margin-bottom:5px;letter-spacing:.5px;">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤</div>';
            item.variants.forEach(function(v, vi) {
              varHtml += '<div class="variant-row">'+
                '<input class="variant-label-input" type="text" value="'+escAttr(v.label)+'" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤" onchange="updateVariant(\''+rk+'\',\''+ck+'\','+idx+','+vi+',\'label\',this.value)">'+
                '<input class="variant-price-input" type="number" value="'+v.price+'" min="0" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" onchange="updateVariant(\''+rk+'\',\''+ck+'\','+idx+','+vi+',\'price\',this.value)">'+
                '<button class="variant-del-btn" onclick="deleteVariant(\''+rk+'\',\''+ck+'\','+idx+','+vi+')">‚úï</button>'+
              '</div>';
            });
            varHtml += '<button class="add-variant-btn" onclick="addVariant(\''+rk+'\',\''+ck+'\','+idx+')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>';
            varHtml += '</div>';
          }

          // Price field: show only if no variants
          const priceField = hasVariants ? '' :
            '<input class="me-item-price" type="number" value="'+item.price+'" min="0" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" onchange="updateItemField(\''+rk+'\',\''+ck+'\','+idx+',\'price\',this.value)">';

          html += '<div class="me-item-row" id="me-item-'+escId(restKey+'_'+catKey)+'_'+idx+'">'+
            '<button class="me-item-emoji-btn" onclick="openEmojiPicker({type:\'item\',restKey:\''+rk+'\',catKey:\''+ck+'\',idx:'+idx+'})">'+item.emoji+'</button>'+
            '<div class="me-item-fields">'+
              '<input class="me-item-name" type="text" value="'+escAttr(item.name)+'" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£" onchange="updateItemField(\''+rk+'\',\''+ck+'\','+idx+',\'name\',this.value)">'+
              priceField+
              '<select class="me-item-tag" onchange="updateItemField(\''+rk+'\',\''+ck+'\','+idx+',\'tag\',this.value)">'+
                '<option value="" '+((!item.tag||item.tag==='')?'selected':'')+'>‡∏õ‡∏Å‡∏ï‡∏¥</option>'+
                '<option value="rec" '+(item.tag==='rec'?'selected':'')+'>‚≠ê ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</option>'+
                '<option value="hot" '+(item.tag==='hot'?'selected':'')+'>üî• ‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</option>'+
                '<option value="new" '+(item.tag==='new'?'selected':'')+'>‚ú® ‡πÉ‡∏´‡∏°‡πà</option>'+
              '</select>'+
              '<input class="me-item-desc" type="text" value="'+escAttr(item.desc||'')+'" placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ)" onchange="updateItemField(\''+rk+'\',\''+ck+'\','+idx+',\'desc\',this.value)">'+
              varHtml+
              (!hasVariants ?
                '<button class="add-variant-btn" onclick="addVariant(\''+rk+'\',\''+ck+'\','+idx+')">Ôºã ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤/‡∏û‡∏¥‡πÄ‡∏®‡∏©)</button>' : '')+
            '</div>'+
            '<button class="me-icon-btn danger" onclick="deleteItem(\''+rk+'\',\''+ck+'\','+idx+')">‚úï</button>'+
          '</div>';
        });
        html += '</div>';
        html += '<button class="me-add-item-btn" onclick="addItem(\''+escAttr(restKey)+'\',\''+escAttr(catKey)+'\')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>';
        html += '</div>';
      }
      html += '<button class="me-add-cat-btn" onclick="addCategory(\''+escAttr(restKey)+'\')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</button>';
      html += '</div></div>';
    }
  }
  wrap.innerHTML = html;
}

function escAttr(s) { return String(s).replace(/&/g,'&amp;').replace(/'/g,'&#39;').replace(/"/g,'&quot;'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MENU EDITOR CRUD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addRestaurant() {
  const name = '‡∏£‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà ' + (Object.keys(editingMenus).length+1);
  editingMenus[name] = { emoji:'üçΩÔ∏è', categories:{ '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà':[] } };
  renderMenuEditor();
}
function deleteRestaurant(restKey) {
  if (!confirm('‡∏•‡∏ö‡∏£‡πâ‡∏≤‡∏ô "'+restKey+'" ‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')) return;
  delete editingMenus[restKey];
  renderMenuEditor();
}
function renameRestaurant(oldKey, newKey) {
  newKey = (newKey || '').trim();
  if (!newKey || newKey === oldKey || newKey === 'undefined') return;
  if (editingMenus[newKey]) { showToast('‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß','error'); return; }
  const data = editingMenus[oldKey]; delete editingMenus[oldKey]; editingMenus[newKey] = data;
  renderMenuEditor();
}
function addCategory(restKey) {
  if (!editingMenus[restKey]) return;
  let name = '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà', n = 1;
  while (editingMenus[restKey].categories[name]) name = '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà '+(n++);
  editingMenus[restKey].categories[name] = [];
  renderMenuEditor();
  // Auto-focus the new category input
  setTimeout(() => {
    const inputs = document.querySelectorAll('.me-cat-name-input');
    if (inputs.length) inputs[inputs.length-1].focus();
  }, 100);
}
function deleteCategory(restKey, catKey) {
  if (!confirm('‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î "'+catKey+'" ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')) return;
  delete editingMenus[restKey].categories[catKey];
  renderMenuEditor();
}
function renameCategory(restKey, oldCat, newCat) {
  newCat = (newCat || '').trim();
  if (!newCat || newCat === oldCat || newCat === 'undefined') return;
  const items = editingMenus[restKey].categories[oldCat];
  delete editingMenus[restKey].categories[oldCat];
  editingMenus[restKey].categories[newCat] = items;
  // Don't re-render ‚Äî just update the key in memory
  // renderMenuEditor() would reset focus; caller can re-render on blur
}
function addItem(restKey, catKey) {
  editingMenus[restKey].categories[catKey].push({ id:'item_'+Date.now(), name:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà', desc:'', price:0, emoji:'üçΩÔ∏è', tag:'', variants:[] });
  renderMenuEditor();
}
function deleteItem(restKey, catKey, idx) {
  editingMenus[restKey].categories[catKey].splice(idx,1);
  renderMenuEditor();
}
function updateItemField(restKey, catKey, idx, field, val) {
  if (!editingMenus[restKey] || !editingMenus[restKey].categories[catKey]) return;
  editingMenus[restKey].categories[catKey][idx][field] = (field==='price') ? Number(val)||0 : val;
}
// Variant CRUD
function addVariant(restKey, catKey, idx) {
  const item = editingMenus[restKey].categories[catKey][idx];
  if (!item.variants) item.variants = [];
  item.variants.push({ label: item.variants.length===0 ? '‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤' : '‡∏û‡∏¥‡πÄ‡∏®‡∏©', price: item.price||0 });
  renderMenuEditor();
}
function deleteVariant(restKey, catKey, idx, vi) {
  editingMenus[restKey].categories[catKey][idx].variants.splice(vi,1);
  renderMenuEditor();
}
function updateVariant(restKey, catKey, idx, vi, field, val) {
  const v = editingMenus[restKey].categories[catKey][idx].variants[vi];
  if (!v) return;
  v[field] = (field==='price') ? Number(val)||0 : val;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  EMOJI PICKER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const EMOJI_PRESETS = ['üçú','üçõ','üçö','üçó','üçñ','ü•©','ü•ì','üç±','ü•ó','üçù','üç£','üçî','üåØ','ü•ô','üç¢','üç°',
  'üßÜ','ü•ö','üç≥','ü•û','ü•§','üßã','ü•õ','‚òï','üçµ','üíß','ü•§','üßÉ','üç∫','ü´ñ',
  'üè™','ü•ò','ü´ï','ü´ô','üßá','üåÆ','ü•™','üçï','üå∂Ô∏è','üßÖ','üßÑ','ü´ö','ü•¨','ü•¶'];

function openEmojiPicker(target) {
  emojiPickerTarget = target;
  document.getElementById('emoji-custom-input').value = '';
  const grid = document.getElementById('emoji-grid');
  grid.innerHTML = EMOJI_PRESETS.map(e => '<button onclick="pickEmoji(\''+e+'\')">'+e+'</button>').join('');
  document.getElementById('emoji-picker-overlay').classList.add('show');
  setTimeout(() => document.getElementById('emoji-custom-input').focus(), 100);
}
function closeEmojiIfOutside(e) { if (e.target.id==='emoji-picker-overlay') closeEmojiPicker(); }
function closeEmojiPicker() { document.getElementById('emoji-picker-overlay').classList.remove('show'); }
function pickEmojiCustom() { const v=document.getElementById('emoji-custom-input').value.trim(); if(v) pickEmoji(v); }
function pickEmoji(emoji) {
  if (!emojiPickerTarget) return;
  const t = emojiPickerTarget;
  if (t.type==='rest') editingMenus[t.restKey].emoji=emoji;
  else if (t.type==='item') editingMenus[t.restKey].categories[t.catKey][t.idx].emoji=emoji;
  closeEmojiPicker();
  renderMenuEditor();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SAVE MENUS TO SHEET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Fallback: save menus via chunked JSONP GET (when POST fails)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SAVE MENUS ‚Äî item-by-item JSONP GET (most reliable, no URL limit)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function importBaanOng() {
  const btn = document.getElementById('import-bo-btn');
  btn.disabled = true; btn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤...';

  const baanOngItems = [
    // ‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo01',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏°‡∏π',desc:'',price:50,emoji:'üçñ',tag:'rec'},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo02',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡πà',desc:'',price:50,emoji:'üçó',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo03',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ô',desc:'',price:50,emoji:'üçö',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo04',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏ï‡∏±‡∏ö',desc:'',price:50,emoji:'üçö',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo05',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏õ‡∏•‡∏≤‡∏î‡∏∏‡∏Å‡∏Å‡∏£‡∏≠‡∏ö',desc:'',price:60,emoji:'üêü',tag:'hot'},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo06',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏ô‡∏∑‡πâ‡∏≠',desc:'',price:60,emoji:'ü•©',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo07',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏ô‡∏∑‡πâ‡∏≠+‡∏õ‡∏•‡∏≤‡∏î‡∏∏‡∏Å‡∏Å‡∏£‡∏≠‡∏ö',desc:'',price:60,emoji:'ü•©',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo08',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏ô‡∏∑‡πâ‡∏≠+‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ô',desc:'',price:60,emoji:'ü•©',tag:''},
    // ‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î',id:'bo09',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏´‡∏°‡∏π',desc:'',price:50,emoji:'üç≥',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î',id:'bo10',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡πÑ‡∏Å‡πà',desc:'',price:50,emoji:'üç≥',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î',id:'bo11',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡πÅ‡∏´‡∏ô‡∏°',desc:'',price:50,emoji:'üç≥',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î',id:'bo12',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏∏‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á',desc:'',price:50,emoji:'üç≥',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î',id:'bo13',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏∏‡πâ‡∏á+‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏≠‡∏ö',desc:'',price:80,emoji:'üç≥',tag:'hot'},
    // ‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo14',name:'‡∏ï‡πâ‡∏°‡∏à‡∏∑‡∏î ‡∏´‡∏°‡∏π/‡πÑ‡∏Å‡πà',desc:'',price:50,emoji:'ü•£',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo15',name:'‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤ ‡∏´‡∏°‡∏π/‡πÑ‡∏Å‡πà',desc:'',price:50,emoji:'üåø',tag:'rec'},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo16',name:'‡∏û‡∏£‡∏¥‡∏Å‡πÅ‡∏Å‡∏á ‡∏´‡∏°‡∏π/‡πÑ‡∏Å‡πà',desc:'',price:50,emoji:'üå∂Ô∏è',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo17',name:'‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ô/‡∏ï‡∏±‡∏ö/‡πÄ‡∏ô‡∏∑‡πâ‡∏≠/‡∏Å‡∏∏‡πâ‡∏á/‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏≠‡∏ö',desc:'',price:60,emoji:'üçñ',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo18',name:'‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö',desc:'',price:50,emoji:'ü•ö',tag:''},
    // ‡πÄ‡∏™‡∏£‡∏¥‡∏°
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡πÄ‡∏™‡∏£‡∏¥‡∏°',id:'bo19',name:'‡πÑ‡∏Ç‡πà‡∏Ñ‡∏≤‡∏ß',desc:'',price:10,emoji:'ü•ö',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡πÄ‡∏™‡∏£‡∏¥‡∏°',id:'bo20',name:'‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß',desc:'',price:10,emoji:'ü•ö',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡πÄ‡∏™‡∏£‡∏¥‡∏°',id:'bo21',name:'‡∏Å‡∏∏‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á',desc:'',price:20,emoji:'üå≠',tag:''},
  ];

  const existing = menuData.filter(i => i.restaurant !== '‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á');
  const merged = [...existing, ...baanOngItems];

  menuData = merged;
  try { localStorage.setItem('menu_data_v2', JSON.stringify(merged)); } catch(x) {}
  buildEditingMenus(merged);
  renderAllGrids();

  try {
    await fetch(SCRIPT_URL, {
      method: 'POST', mode: 'no-cors',
      headers: {'Content-Type': 'text/plain'},
      body: JSON.stringify({action:'saveMenus', rows: merged})
    });
    showToast('‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π ‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á ' + baanOngItems.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß!', 'success');
  } catch(e) {
    showToast('‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß (local)', 'success');
  }
  btn.disabled = false; btn.textContent = 'üè† ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π ‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á';
}

async function importHiaMoo() {
  const btn = document.getElementById('import-hm-btn');
  btn.disabled = true; btn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤...';

  const hiaMooItems = [
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà',id:'hm01',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏ï‡πâ‡∏°',desc:'',price:50,emoji:'üçó',tag:'rec',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:50},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:60}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà',id:'hm02',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î',desc:'',price:50,emoji:'üçó',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:50},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:60}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà',id:'hm03',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏£‡∏ß‡∏°',desc:'‡∏ï‡πâ‡∏°+‡∏ó‡∏≠‡∏î',price:60,emoji:'üçó',tag:'hot',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:60},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:70}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Ç‡πâ‡∏≤‡∏ß',id:'hm04',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡πà‡∏ï‡πâ‡∏°‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤',desc:'',price:60,emoji:'üçö',tag:''},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Ç‡πâ‡∏≤‡∏ß',id:'hm05',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏°‡∏π‡∏™‡∏≤‡∏°‡∏ä‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏°‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤',desc:'',price:69,emoji:'üçñ',tag:''},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏™‡∏∏‡∏Å‡∏µ‡πâ',id:'hm06',name:'‡∏™‡∏∏‡∏Å‡∏µ‡πâ‡∏´‡∏°‡∏π',desc:'‡∏ô‡πâ‡∏≥ / ‡πÅ‡∏´‡πâ‡∏á',price:60,emoji:'üç≤',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:60},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:70}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏™‡∏∏‡∏Å‡∏µ‡πâ',id:'hm07',name:'‡∏™‡∏∏‡∏Å‡∏µ‡πâ‡∏ó‡∏∞‡πÄ‡∏•',desc:'‡∏ô‡πâ‡∏≥ / ‡πÅ‡∏´‡πâ‡∏á',price:70,emoji:'ü¶ê',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:70},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:80}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏™‡∏∏‡∏Å‡∏µ‡πâ',id:'hm08',name:'‡∏™‡∏∏‡∏Å‡∏µ‡πâ‡∏£‡∏ß‡∏°',desc:'‡∏ô‡πâ‡∏≥ / ‡πÅ‡∏´‡πâ‡∏á',price:80,emoji:'üç≤',tag:'hot',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:80},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:90}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß',id:'hm09',name:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡∏´‡∏°‡∏π‡∏ô‡πâ‡∏≥‡πÉ‡∏™',desc:'‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å / ‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà / ‡∏´‡∏°‡∏µ‡∏Ç‡∏≤‡∏ß / ‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà / ‡∏°‡∏≤‡∏°‡πà‡∏≤ / ‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏™‡πâ‡∏ô',price:40,emoji:'üçú',tag:'rec',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:40},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:50}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß',id:'hm10',name:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡∏´‡∏°‡∏π‡∏ï‡πâ‡∏°‡∏¢‡∏≥',desc:'‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å / ‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà / ‡∏´‡∏°‡∏µ‡∏Ç‡∏≤‡∏ß / ‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà / ‡∏°‡∏≤‡∏°‡πà‡∏≤ / ‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏™‡πâ‡∏ô',price:50,emoji:'üçú',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:50},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:60}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß',id:'hm11',name:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡∏ï‡πâ‡∏°‡∏¢‡∏≥‡∏£‡∏ß‡∏°',desc:'‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å / ‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà / ‡∏´‡∏°‡∏µ‡∏Ç‡∏≤‡∏ß / ‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà / ‡∏°‡∏≤‡∏°‡πà‡∏≤ / ‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏™‡πâ‡∏ô',price:60,emoji:'üçú',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:60},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:70}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß',id:'hm12',name:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡∏ï‡πâ‡∏°‡∏¢‡∏≥‡πÄ‡∏Å‡∏µ‡πâ‡∏¢‡∏ß‡∏™‡πâ‡∏ß‡∏ô',desc:'‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å / ‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà / ‡∏´‡∏°‡∏µ‡∏Ç‡∏≤‡∏ß / ‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà / ‡∏°‡∏≤‡∏°‡πà‡∏≤ / ‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏™‡πâ‡∏ô',price:70,emoji:'üçú',tag:'hot',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:70},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:80}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤',id:'hm13',name:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤‡∏´‡∏°‡∏π‡∏ô‡πâ‡∏≥‡πÉ‡∏™',desc:'',price:60,emoji:'ü•£',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:60},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:70}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤',id:'hm14',name:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤‡∏ï‡πâ‡∏°‡∏¢‡∏≥‡∏£‡∏ß‡∏°',desc:'',price:70,emoji:'ü•£',tag:'hot',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:70},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:80}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤',id:'hm15',name:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤‡∏ï‡πâ‡∏°‡∏¢‡∏≥‡∏´‡∏°‡∏π',desc:'',price:60,emoji:'ü•£',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:60},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:70}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤',id:'hm16',name:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤‡πÄ‡∏Å‡∏µ‡πâ‡∏¢‡∏ß‡∏õ‡∏•‡∏≤‡∏•‡πâ‡∏ß‡∏ô',desc:'',price:70,emoji:'ü•£',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:70},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:80}]},
  ];

  // Merge: keep existing non-‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π items + add new ‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π
  const existing = menuData.filter(i => i.restaurant !== '‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π');
  const merged = [...existing, ...hiaMooItems];

  // Update local state
  menuData = merged;
  try { localStorage.setItem('menu_data_v2', JSON.stringify(merged)); } catch(x) {}
  buildEditingMenus(merged);
  renderAllGrids();

  // Save to Sheets
  try {
    await fetch(SCRIPT_URL, {
      method: 'POST', mode: 'no-cors',
      headers: {'Content-Type': 'text/plain'},
      body: JSON.stringify({action:'saveMenus', rows: merged})
    });
    showToast('‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π ' + hiaMooItems.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß!', 'success');
  } catch(e) {
    showToast('‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß (local)', 'success');
  }
  btn.disabled = false; btn.textContent = 'üêñ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π';
}

async function saveMenusToSheet() {
  const btn  = document.querySelector('.me-save-btn');
  const info = document.getElementById('me-save-info');
  btn.disabled = true;

  // Build flat row list
  const rows = [];
  for (const [restName, restVal] of Object.entries(editingMenus)) {
    for (const [catName, items] of Object.entries(restVal.categories)) {
      for (const item of items) {
        const itemName = (item.name||'').trim();
        if (!itemName) continue; // skip blank name
        rows.push({
          id:             item.id || ('item_'+Date.now()+'_'+Math.random().toString(36).slice(2,6)),
          restaurant:     restName,
          restaurantEmoji:restVal.emoji || 'üçΩÔ∏è',
          category:       catName,
          name:           item.name || '',
          desc:           item.desc || '',
          price:          Number(item.price) || 0,
          emoji:          item.emoji || 'üçΩÔ∏è',
          tag:            item.tag  || '',
          variants:       item.variants || []
        });
      }
    }
  }

  if (!rows.length) {
    showToast('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£', 'error');
    btn.disabled = false; btn.innerHTML = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏ô‡∏π';
    return;
  }

  // Update local state + localStorage immediately
  menuData = rows;
  renderAllGrids();
  try { localStorage.setItem('menu_data_v2', JSON.stringify(rows)); } catch(x) {}

  try {
    btn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
    await fetch(SCRIPT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type': 'text/plain'},
      body: JSON.stringify({action:'saveMenus', rows:rows})
    });
    showToast('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ' + rows.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß!', 'success');
    if (info) info.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ' + new Date().toLocaleTimeString('th-TH');
  } catch(e) {
    showToast('‚ùå ' + e.message, 'error');
  }
  btn.disabled = false;
  btn.innerHTML = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏ô‡∏π';
}




// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Fix Sheets (insert missing headers)
async function fixSheets() {
  showToast('‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Sheets...', 'success');
  try {
    const res = await jsonpFetch(SCRIPT_URL + '?action=fixSheets');
    if (res.success) {
      showToast('‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß: ' + (res.fixed||[]).join(', '), 'success');
    } else {
      showToast('‚ùå ' + (res.error||'fail'), 'error');
    }
    console.log('fixSheets:', res);
  } catch(e) {
    showToast('‚ùå ' + e.message, 'error');
  }
}

// Test connection to Apps Script
async function testConnection() {
  const btn = document.getElementById('test-conn-btn');
  const orig = btn.textContent;
  btn.textContent = '‚è≥';
  try {
    const res = await jsonpFetch(SCRIPT_URL + '?action=ping');
    showToast('‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ! v' + (res.v||'?'), 'success');
    console.log('Ping result:', res);
  } catch(e) {
    showToast('‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ' + e.message, 'error');
    console.error('Ping error:', e);
  }
  btn.textContent = orig;
}

// Download QR as blob (cross-origin workaround)
async function downloadQR(url, filename) {
  try {
    const resp = await fetch(url);
    const blob = await resp.blob();
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
    setTimeout(() => URL.revokeObjectURL(a.href), 5000);
  } catch(e) {
    // CORS blocked ‚Äî open in new tab, user can save manually
    window.open(url, '_blank');
    showToast('‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û"', 'success');
  }
}

let _tt;
function showToast(msg,type='success') {
  const t=document.getElementById('toast');
  t.textContent=msg; t.className='toast '+type+' show';
  clearTimeout(_tt); _tt=setTimeout(()=>t.classList.remove('show'),2800);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  QR NOTIFICATION POLLING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let _qrPollTimer = null;

function startQrPolling() {
  if (_qrPollTimer) return;
  initNotifications(); // ‡∏Ç‡∏≠ permission + register SW
  _qrPollTimer = setInterval(()=>{ checkQrNotification(); checkBroadcast(); }, 5000);
  checkQrNotification();
  checkBroadcast();
}

async function checkQrNotification() {
  if (!currentUser) return;
  try {
    const notifKey = encodeURIComponent('qr_' + currentUser);
    const notif = await jsonpFetch(SCRIPT_URL + '?action=getNotif&key=' + notifKey);

    // QR cleared ‚Äî ‡∏õ‡∏¥‡∏î popup ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πâ‡∏≤‡∏á
    if (!notif || !notif.value || !notif.ts) {
      const overlay = document.getElementById('qr-notif-overlay');
      if (overlay && overlay.style.display !== 'none') {
        overlay.style.display = 'none';
        document.querySelectorAll('.bottom-bar,.topbar').forEach(el=>el.style.display='');
      }
      localStorage.removeItem('qr_seen_ts_' + currentUser);
      return;
    }

    // seenTs check
    const seenTs = localStorage.getItem('qr_seen_ts_' + currentUser) || '';
    if (notif.ts === seenTs) return;

    // popup ‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚Äî ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ã‡πâ‡∏≥
    const overlay = document.getElementById('qr-notif-overlay');
    if (overlay && overlay.style.display === 'flex') {
      localStorage.setItem('qr_seen_ts_' + currentUser, notif.ts);
      return;
    }

    // ‡πÅ‡∏™‡∏î‡∏á QR popup ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ ack
    localStorage.setItem('qr_seen_ts_' + currentUser, notif.ts);
    showQrNotif(JSON.parse(notif.value));
  } catch(e) {}
}

function showQrNotif(data) {
  document.getElementById('qrn-name').textContent = 'üë§ ' + (data.person||'');
  document.getElementById('qrn-amount').textContent = '‡∏ø' + (data.amount||0);
  document.getElementById('qrn-img').src = data.qrUrl || '';
  // Store phone+amount for copy button
  const copyBtn = document.getElementById('qrn-copy-btn');
  if (copyBtn) { copyBtn.dataset.phone = localStorage.getItem('food_order_phone')||''; copyBtn.dataset.amount = data.amount||0; }
  // Store qrUrl for save button
  const saveBtn = document.getElementById('qrn-save-btn');
  if (saveBtn) saveBtn.dataset.url = data.qrUrl||'';
  const itemsEl = document.getElementById('qrn-items');
  itemsEl.innerHTML = (data.items||[]).map(it =>
    '<div>' + it.emoji + ' ' + it.name + ' √ó' + it.qty + ' ‚Äî ‡∏ø' + it.actual + '</div>'
  ).join('');
  document.getElementById('qr-notif-overlay').style.display = 'flex';
  // ‡∏ã‡πà‡∏≠‡∏ô bottom-bar ‡πÅ‡∏•‡∏∞ topbar ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ö popup
  document.querySelectorAll('.bottom-bar,.topbar').forEach(el=>el.style.display='none');

  // Badge API (PWA icon badge)
  if (typeof updateAppBadge === 'function') updateAppBadge(1);

  // Web Notification
  sendNativeNotif('üí≥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô', 'üë§ ' + data.person + '  ‡∏ø' + data.amount, 'qr-payment');
}

// ‚îÄ‚îÄ Native Notification System ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function testNotification() {
  if (!('Notification' in window)) {
    showToast('‚ùå Browser ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Notification','error'); return;
  }
  if (Notification.permission === 'denied') {
    showToast('‚ùå Notification ‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÉ‡∏ô Settings ‡∏Ç‡∏≠‡∏á Browser','error'); return;
  }
  if (Notification.permission === 'default') {
    Notification.requestPermission().then(p => {
      if (p === 'granted') { sendNativeNotif('‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!','‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥ üéâ','test'); showToast('‚úÖ ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡πâ‡∏ß ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','success'); }
      else showToast('‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Notification','error');
    }); return;
  }
  sendNativeNotif('‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô','- ‡∏Å‡∏¥‡∏ô ‡∏≠‡∏∞‡πÑ‡∏£ ‡∏î‡∏µ - ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß üç±','test');
  showToast('üì≤ ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß','success');
}

async function initNotifications() {
  if (!('Notification' in window)) return;
  if (Notification.permission === 'default') {
    await Notification.requestPermission();
  }
}

function sendNativeNotif(title, body, tag) {
  if (!('Notification' in window) || Notification.permission !== 'granted') return;
  try {
    const n = new Notification(title, {
      body,
      icon: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14/assets/72x72/1f371.png',
      badge: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14/assets/72x72/1f371.png',
      tag: tag || 'ginawidee',
      requireInteraction: true,
      silent: false
    });
    n.onclick = () => { window.focus(); n.close(); };
  } catch(e) { console.warn('Notification error:', e); }
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BROADCAST NOTIFICATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openBcastModal() {
  document.getElementById('bcast-modal-overlay').style.display = 'flex';
  document.getElementById('bcast-custom').value = '';
  document.querySelectorAll('.bcast-option').forEach(b=>b.classList.remove('selected'));
}
function closeBcastModal() {
  document.getElementById('bcast-modal-overlay').style.display = 'none';
}
function selectBcastOption(btn) {
  document.querySelectorAll('.bcast-option').forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
  document.getElementById('bcast-custom').value = '';
}
function deselectBcastOptions() {
  document.querySelectorAll('.bcast-option').forEach(b=>b.classList.remove('selected'));
}
async function sendBroadcast() {
  const selected = document.querySelector('.bcast-option.selected');
  const custom   = document.getElementById('bcast-custom').value.trim();
  const msg = selected ? selected.textContent.trim() : custom;
  if (!msg) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°','error'); return; }
  const ts = String(Date.now());
  jsonpFetch(SCRIPT_URL + '?action=saveNotif&key=broadcast&value=' + encodeURIComponent(msg) + '&ts=' + ts).catch(()=>{});
  localStorage.setItem('bcast_seen_ts_' + currentUser, ts);
  closeBcastModal();
  showToast('‚úÖ ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß!', 'success');
}

// Polling broadcast ‚Äî ‡πÉ‡∏ä‡πâ pattern ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö QR notification
async function checkBroadcast() {
  if (!currentUser) return;
  try {
    const res = await jsonpFetch(SCRIPT_URL + '?action=getNotif&key=broadcast');
    if (!res || !res.value || !res.ts) return;
    const seenKey = 'bcast_seen_ts_' + currentUser;
    const seenTs  = localStorage.getItem(seenKey) || '';
    if (res.ts === seenTs) return;
    localStorage.setItem(seenKey, res.ts);
    showBcastNotif(res.value);
  } catch(e) {}
}
function showBcastNotif(msg) {
  // Native notification ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠ (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏°‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ)
  sendNativeNotif('üç± - ‡∏Å‡∏¥‡∏ô ‡∏≠‡∏∞‡πÑ‡∏£ ‡∏î‡∏µ -', msg, 'broadcast');
  // In-app bar (optional)
  const bar = document.getElementById('bcast-notif-bar');
  const txt = document.getElementById('bcast-notif-text');
  if (bar && txt) {
    txt.textContent = msg;
    bar.style.display = 'flex';
    setTimeout(()=>{ if(bar && bar.style.display!='none') closeBcastNotif(); }, 8000);
  }
}
function closeBcastNotif() {
  document.getElementById('bcast-notif-bar').style.display = 'none';
}

function openBankingApp() {
  const btn = document.getElementById('qrn-bank-btn');
  const amount = btn ? btn.dataset.amount : '0';

  // ‡∏î‡∏∂‡∏á phone ‡∏à‡∏≤‡∏Å localStorage (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≠‡∏ô Admin ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤)
  const phone = localStorage.getItem('food_order_phone') || '';

  // promptpay:// URI ‚Äî ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏û‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
  // format: promptpay://payment?mobile=<phone>&amount=<amount>
  const uri = 'promptpay://payment?mobile=' + encodeURIComponent(phone) + '&amount=' + amount;

  // ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î promptpay:// ‡∏Å‡πà‡∏≠‡∏ô ‚Äî ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏≠‡∏û fallback ‡πÄ‡∏õ‡∏¥‡∏î QR image ‡πÉ‡∏ô browser
  const fallbackUrl = btn ? btn.dataset.url : '';
  
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á hidden link ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Å
  const a = document.createElement('a');
  a.href = uri;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);

  // Fallback ‡∏´‡∏•‡∏±‡∏á 1.5 ‡∏ß‡∏¥ ‡∏ñ‡πâ‡∏≤‡πÅ‡∏≠‡∏û‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î QR ‡πÉ‡∏ô browser ‡πÅ‡∏ó‡∏ô
  setTimeout(() => {
    if (document.visibilityState !== 'hidden' && fallbackUrl) {
      window.open(fallbackUrl, '_blank');
    }
  }, 1500);
}

function saveQrImage() {
  const btn = document.getElementById('qrn-save-btn');
  const url = btn ? btn.dataset.url : '';
  if (!url) return;
  const a = document.createElement('a');
  a.href = url;
  a.download = 'PromptPay_QR.png';
  a.target = '_blank';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  btn.textContent = '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß!';
  setTimeout(() => { btn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å QR'; }, 2000);
}

function copyPromptPay() {
  const btn = document.getElementById('qrn-copy-btn');
  const phone  = btn ? btn.dataset.phone  : '';
  const amount = btn ? btn.dataset.amount : '';
  // ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå + ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô ‡πÉ‡∏´‡πâ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô chat ‡πÅ‡∏≠‡∏û‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
  const text = phone + (amount ? ' ‡∏¢‡∏≠‡∏î ‡∏ø' + amount : '');
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!';
    setTimeout(() => { btn.innerHTML = 'üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå'; }, 2000);
  }).catch(() => {
    // fallback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πà‡∏≤
    const ta = document.createElement('textarea');
    ta.value = text; ta.style.position='fixed'; ta.style.opacity='0';
    document.body.appendChild(ta); ta.select(); document.execCommand('copy');
    document.body.removeChild(ta);
    btn.textContent = '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!';
    setTimeout(() => { btn.innerHTML = 'üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå'; }, 2000);
  });
}

function dismissQrNotif() {
  document.getElementById('qr-notif-overlay').style.display = 'none';
  // ‡∏Ñ‡∏∑‡∏ô bottom-bar ‡πÅ‡∏•‡∏∞ topbar
  document.querySelectorAll('.bottom-bar,.topbar').forEach(el=>el.style.display='');
  if (currentUser) {
    // Use seenTs (= notif.ts) so ack.ts >= notif.ts is guaranteed
    const seenTs = localStorage.getItem('qr_seen_ts_' + currentUser) || String(Date.now());
    const ackKey = encodeURIComponent('qr_ack_' + currentUser);
    jsonpFetch(SCRIPT_URL + '?action=saveNotif&key=' + ackKey + '&value=paid&ts=' + seenTs).catch(()=>{});
  }
  if (typeof updateAppBadge === 'function') updateAppBadge(0);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(async function init() {
  function isMenuRow(r) { return r && r.category !== undefined && r.id && !r.timestamp; }

  // ‚îÄ‚îÄ 1. ‡πÇ‡∏´‡∏•‡∏î localStorage ‡∏Å‡πà‡∏≠‡∏ô ‚Äî ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let loaded = false;
  try {
    const ls = localStorage.getItem('menu_data_v2');
    if (ls) {
      const rows = JSON.parse(ls);
      if (rows.length && isMenuRow(rows[0])) {
        menuData = rows; buildEditingMenus(rows); renderAllGrids(); loaded = true;
      }
    }
  } catch(e) {}
  if (!loaded) { loadDefaultMenus(); }

  // ‚îÄ‚îÄ 2. Auto-login ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const saved = localStorage.getItem('food_order_name');
  if (saved) {
    currentUser = saved;
    document.getElementById('display-name').textContent = saved;
    showPage('page-menu');
    startQrPolling();
  }
  renderAllGrids();

  // ‚îÄ‚îÄ 3. Sync ‡∏à‡∏≤‡∏Å GAS ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á (‡πÑ‡∏°‡πà‡∏ö‡∏•‡πá‡∏≠‡∏Å UI) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  jsonpFetch(SCRIPT_URL + '?action=getMenus').then(json => {
    if (json && json.rows && json.rows.length && isMenuRow(json.rows[0])) {
      menuData = json.rows;
      try { localStorage.setItem('menu_data_v2', JSON.stringify(json.rows)); } catch(x) {}
      buildEditingMenus(json.rows);
      renderAllGrids();
    }
  }).catch(()=>{});

  // Load orders badge ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á
  jsonpFetch(SCRIPT_URL+'?action=get').then(j=>updateOrdersBadge(j.rows||[])).catch(()=>{});
})();

function loadDefaultMenus() {
  const defaults = [
    // ‚îÄ‚îÄ ‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo01',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏°‡∏π',desc:'',price:50,emoji:'üçñ',tag:'rec'},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo02',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡πà',desc:'',price:50,emoji:'üçó',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo03',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ô',desc:'',price:50,emoji:'üçö',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo04',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏ï‡∏±‡∏ö',desc:'',price:50,emoji:'üçö',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo05',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏õ‡∏•‡∏≤‡∏î‡∏∏‡∏Å‡∏Å‡∏£‡∏≠‡∏ö',desc:'',price:60,emoji:'üêü',tag:'hot'},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo06',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏ô‡∏∑‡πâ‡∏≠',desc:'',price:60,emoji:'ü•©',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo07',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏ô‡∏∑‡πâ‡∏≠+‡∏õ‡∏•‡∏≤‡∏î‡∏∏‡∏Å‡∏Å‡∏£‡∏≠‡∏ö',desc:'',price:60,emoji:'ü•©',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo08',name:'‡∏£‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏ô‡∏∑‡πâ‡∏≠+‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ô',desc:'',price:60,emoji:'ü•©',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î',id:'bo09',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏´‡∏°‡∏π',desc:'',price:50,emoji:'üç≥',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î',id:'bo10',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡πÑ‡∏Å‡πà',desc:'',price:50,emoji:'üç≥',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î',id:'bo11',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡πÅ‡∏´‡∏ô‡∏°',desc:'',price:50,emoji:'üç≥',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î',id:'bo12',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏∏‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á',desc:'',price:50,emoji:'üç≥',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î',id:'bo13',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏∏‡πâ‡∏á+‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏≠‡∏ö',desc:'',price:80,emoji:'üç≥',tag:'hot'},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo14',name:'‡∏ï‡πâ‡∏°‡∏à‡∏∑‡∏î ‡∏´‡∏°‡∏π/‡πÑ‡∏Å‡πà',desc:'',price:50,emoji:'ü•£',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo15',name:'‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤ ‡∏´‡∏°‡∏π/‡πÑ‡∏Å‡πà',desc:'',price:50,emoji:'üåø',tag:'rec'},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo16',name:'‡∏û‡∏£‡∏¥‡∏Å‡πÅ‡∏Å‡∏á ‡∏´‡∏°‡∏π/‡πÑ‡∏Å‡πà',desc:'',price:50,emoji:'üå∂Ô∏è',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo17',name:'‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ô/‡∏ï‡∏±‡∏ö/‡πÄ‡∏ô‡∏∑‡πâ‡∏≠/‡∏Å‡∏∏‡πâ‡∏á/‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏≠‡∏ö',desc:'',price:60,emoji:'üçñ',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß',id:'bo18',name:'‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö',desc:'',price:50,emoji:'ü•ö',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡πÄ‡∏™‡∏£‡∏¥‡∏°',id:'bo19',name:'‡πÑ‡∏Ç‡πà‡∏Ñ‡∏≤‡∏ß',desc:'',price:10,emoji:'ü•ö',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡πÄ‡∏™‡∏£‡∏¥‡∏°',id:'bo20',name:'‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß',desc:'',price:10,emoji:'ü•ö',tag:''},
    {restaurant:'‡∏≠.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πà‡∏á',restaurantEmoji:'üè†',category:'‡πÄ‡∏™‡∏£‡∏¥‡∏°',id:'bo21',name:'‡∏Å‡∏∏‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á',desc:'',price:20,emoji:'üå≠',tag:''},
    // ‚îÄ‚îÄ ‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà',id:'hm01',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏ï‡πâ‡∏°',desc:'',price:50,emoji:'üçó',tag:'rec',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:50},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:60}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà',id:'hm02',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î',desc:'',price:50,emoji:'üçó',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:50},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:60}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà',id:'hm03',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏£‡∏ß‡∏°',desc:'‡∏ï‡πâ‡∏°+‡∏ó‡∏≠‡∏î',price:60,emoji:'üçó',tag:'hot',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:60},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:70}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Ç‡πâ‡∏≤‡∏ß',id:'hm04',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡πà‡∏ï‡πâ‡∏°‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤',desc:'',price:60,emoji:'üçö',tag:''},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Ç‡πâ‡∏≤‡∏ß',id:'hm05',name:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏°‡∏π‡∏™‡∏≤‡∏°‡∏ä‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏°‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤',desc:'',price:69,emoji:'üçñ',tag:''},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏™‡∏∏‡∏Å‡∏µ‡πâ',id:'hm06',name:'‡∏™‡∏∏‡∏Å‡∏µ‡πâ‡∏´‡∏°‡∏π',desc:'‡∏ô‡πâ‡∏≥ / ‡πÅ‡∏´‡πâ‡∏á',price:60,emoji:'üç≤',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:60},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:70}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏™‡∏∏‡∏Å‡∏µ‡πâ',id:'hm07',name:'‡∏™‡∏∏‡∏Å‡∏µ‡πâ‡∏ó‡∏∞‡πÄ‡∏•',desc:'‡∏ô‡πâ‡∏≥ / ‡πÅ‡∏´‡πâ‡∏á',price:70,emoji:'ü¶ê',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:70},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:80}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏™‡∏∏‡∏Å‡∏µ‡πâ',id:'hm08',name:'‡∏™‡∏∏‡∏Å‡∏µ‡πâ‡∏£‡∏ß‡∏°',desc:'‡∏ô‡πâ‡∏≥ / ‡πÅ‡∏´‡πâ‡∏á',price:80,emoji:'üç≤',tag:'hot',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:80},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:90}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß',id:'hm09',name:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡∏´‡∏°‡∏π‡∏ô‡πâ‡∏≥‡πÉ‡∏™',desc:'‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å / ‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà / ‡∏´‡∏°‡∏µ‡∏Ç‡∏≤‡∏ß / ‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà / ‡∏°‡∏≤‡∏°‡πà‡∏≤ / ‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏™‡πâ‡∏ô',price:40,emoji:'üçú',tag:'rec',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:40},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:50}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß',id:'hm10',name:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡∏´‡∏°‡∏π‡∏ï‡πâ‡∏°‡∏¢‡∏≥',desc:'‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å / ‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà / ‡∏´‡∏°‡∏µ‡∏Ç‡∏≤‡∏ß / ‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà / ‡∏°‡∏≤‡∏°‡πà‡∏≤ / ‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏™‡πâ‡∏ô',price:50,emoji:'üçú',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:50},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:60}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß',id:'hm11',name:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡∏ï‡πâ‡∏°‡∏¢‡∏≥‡∏£‡∏ß‡∏°',desc:'‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å / ‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà / ‡∏´‡∏°‡∏µ‡∏Ç‡∏≤‡∏ß / ‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà / ‡∏°‡∏≤‡∏°‡πà‡∏≤ / ‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏™‡πâ‡∏ô',price:60,emoji:'üçú',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:60},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:70}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß',id:'hm12',name:'‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡∏ï‡πâ‡∏°‡∏¢‡∏≥‡πÄ‡∏Å‡∏µ‡πâ‡∏¢‡∏ß‡∏™‡πâ‡∏ß‡∏ô',desc:'‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å / ‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà / ‡∏´‡∏°‡∏µ‡∏Ç‡∏≤‡∏ß / ‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà / ‡∏°‡∏≤‡∏°‡πà‡∏≤ / ‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏™‡πâ‡∏ô',price:70,emoji:'üçú',tag:'hot',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:70},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:80}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤',id:'hm13',name:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤‡∏´‡∏°‡∏π‡∏ô‡πâ‡∏≥‡πÉ‡∏™',desc:'',price:60,emoji:'ü•£',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:60},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:70}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤',id:'hm14',name:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤‡∏ï‡πâ‡∏°‡∏¢‡∏≥‡∏£‡∏ß‡∏°',desc:'',price:70,emoji:'ü•£',tag:'hot',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:70},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:80}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤',id:'hm15',name:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤‡∏ï‡πâ‡∏°‡∏¢‡∏≥‡∏´‡∏°‡∏π',desc:'',price:60,emoji:'ü•£',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:60},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:70}]},
    {restaurant:'‡πÄ‡∏Æ‡∏µ‡∏¢‡∏´‡∏°‡∏π',restaurantEmoji:'üêñ',category:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤',id:'hm16',name:'‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤‡πÄ‡∏Å‡∏µ‡πâ‡∏¢‡∏ß‡∏õ‡∏•‡∏≤‡∏•‡πâ‡∏ß‡∏ô',desc:'',price:70,emoji:'ü•£',tag:'',variants:[{label:'‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤',price:70},{label:'‡∏û‡∏¥‡πÄ‡∏®‡∏©',price:80}]},
  ];
  menuData = defaults;
  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage ‡∏î‡πâ‡∏ß‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ reload ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
  try { localStorage.setItem('menu_data_v2', JSON.stringify(defaults)); } catch(x) {}
  buildEditingMenus(defaults);
}
</script>
</body>
</html>
